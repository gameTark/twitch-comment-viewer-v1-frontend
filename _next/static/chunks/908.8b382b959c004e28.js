!function(){var e,t,a,n,i,r,o={77908:function(e,t,a){"use strict";let n;var i=a(59772);let r=i.Ry({createdAt:i.hT().optional().default(new Date),updateAt:i.hT().optional().default(new Date),deletedAt:i.hT().optional()}),o=i.Z_();i.Ry({id:o,displayName:i.Z_().optional(),login:i.Z_(),type:i.Z_().optional(),broadcasterType:i.Z_().optional(),description:i.Z_().optional(),profileImageUrl:i.Z_().optional(),offlineImageUrl:i.Z_().optional(),metaComment:i.Z_().optional(),isSpam:i.O7().optional().default(!1),rowData:i.Z_().optional()}).and(r);let s=i.Ry({id:i.Rx().optional(),channelId:o,tpye:i.Km(["update","offline","online"]),broadcastTitle:i.Z_(),categoryId:i.Z_(),categoryName:i.Z_(),language:i.Z_(),timestamp:i.hT().default(new Date),rowdata:i.Z_().optional()}).and(r),l=i.Ry({type:i.Km(["chatters"]),value:i.Ry({users:i.IX(o).default([]),total:i.Rx().optional().default(0)})});i.Ry({type:i.Km(["live"]),value:i.Ry({isLive:i.O7().optional().default(!1),viewCount:i.Rx().optional().default(0),startedAt:i.hT().optional().nullable().default(null)})}),i.Ry({type:i.Km(["me"]),value:i.Ry({id:o,login:i.Z_()}).optional()}),a(2265);let d=i.Ry({user_id:o,user_login:i.Z_(),user_name:i.Z_()}),c=i.Ry({prefix:i.Z_(),bits:i.Rx(),tier:i.Rx()}),u=i.Ry({id:i.Z_(),emote_set_id:i.Z_(),owner_id:i.Z_(),format:i.Z_().array()}),p=i.Ry({type:i.Km(["text"]),text:i.Z_(),cheermote:c.optional(),emote:i.lB(),mention:i.lB()}),m=i.Ry({type:i.Km(["mention"]),text:i.Z_(),cheermote:c.optional(),emote:i.lB(),mention:d}),h=i.Ry({type:i.Km(["emote"]),text:i.Z_(),cheermote:c.optional(),emote:u,mention:i.lB()}),_=p.or(m).or(h),y=i.Ry({autoincrementId:i.Rx().optional(),id:i.Z_(),channel:i.Z_(),userId:o.nullable().default(null),timestamp:i.Rx().optional(),bits:i.Z_().optional(),rowdata:i.Z_().optional()}).and(r),w=i.Ry({messageType:i.Km(["chat"]),message:i.Z_(),fragments:_.array()}).and(y),f=i.Ry({messageType:i.Km(["reward","atutomatic-reward"]),rewardId:i.Z_(),userTitle:i.Z_(),userInput:i.Z_()}).and(y);w.or(f),i.Ry({id:i.Rx().optional(),channelId:i.Z_().optional(),gameId:i.Z_().optional(),broadcastTitle:i.Z_().max(140,"最大140文字まで入力可能です。").default(""),language:i.Z_(),tags:i.IX(i.Z_()).max(25,"最大のタグ数は25件までです。").default([]),classificationLabels:i.Z_().array().default([]),isBrandedContent:i.O7().default(!1),favorite:i.O7().optional().default(!1)}).and(r),i.Ry({id:i.Rx().optional(),channelId:o,userId:o,followedAt:i.hT()}).and(r),i.Ry({id:i.Z_(),name:i.Z_(),box_art_url:i.Z_().url(),igdb_id:i.Z_()}).and(r);var v=a(33427);a(91279);class g extends v.ZP{async getMe(){let e=await this.parameters.get("me");if((null==e?void 0:e.type)!=null&&"me"===e.type&&null!=e.value)return e.value}async getLive(){let e=await this.parameters.get("live");return(null==e?void 0:e.type)==null||"live"!==e.type||null==e.value?{isLive:!1,viewCount:0,startedAt:null}:e.value}async getChatters(){let e=await this.parameters.get("chatters");return(null==e?void 0:e.type)==null||"chatters"!==e.type||null==e.value?{users:[],total:0}:e.value}constructor(){super("twitch-comments"),this.version(30).stores({users:"id,*userId,displayName,type,broadcasterType",games:"id,igdb_id,name",actions:"++autoincrementId,id,*channel,messageType,*userId,*timestamp,[channel+timestamp]",followers:"++id,channelId,userId,[channelId+userId],createdAt,[channelId+createdAt]",channelHistories:"++id,channelId,type,categoryId,timestamp,[channelId+timestamp]",listenerHistories:"++id,channelId,userId,[channelId+timestamp]",broadcastTemplates:"++id,channelId,gameId,*tags,favorite",parameters:"type",spam:"login",settings:"id"})}}let T=new g;var E=a(62737),I=a.n(E);a(39055);var O=a(90748),N=a.n(O),D=a(86688),S=a.n(D),b=a(51470),A=a.n(b);I().extend(S()),I().extend(A()),I().extend(N()),I().locale("ja");let x=I(),P=e=>x(e.target).isSameOrBefore(x(e.current||new Date).subtract(e.num,e.ago));var R=a(12491);let{API_LIST:Z,API_KEY:C}={CLASSIFICATION_LABELS:[{name:"薬物・酩酊・過度の喫煙",id:"DrugsIntoxication",description:"タバコの過度な賛美・宣伝、マリファナの摂取・使用、合法薬物やアルコールによる酩酊、違法薬物の話題。"},{name:"性的なテーマ",id:"SexualThemes",description:"実際に金銭のやり取りが発生する、オンラインまたは対面式のギャンブル、ポーカー、ファンタジースポーツへの参加。"},{name:"著しい冒涜や下品な表現",id:"ProfanityVulgarity",description:"特に通常の会話内での、猥褻的・冒涜的・下品な表現の頻繁な使用。"},{name:"ギャンブル",id:"Gambling",description:"実際に金銭のやり取りが発生する、オンラインまたは対面式のギャンブル、ポーカー、ファンタジースポーツへの参加。"},{name:"暴力的で露骨な描写",id:"ViolentGraphic",description:"リアルな暴力、流血、重傷、死のシミュレーションや描写。"}],BROADCAST_LANGUAGE:[{id:"ja",name:"日本語"},{id:"en",name:"English"},{id:"id",name:"Bahasa Indonesia"},{id:"ca",name:"Catal\xe0"},{id:"da",name:"Dansk"},{id:"de",name:"Deutsch"},{id:"es",name:"Espa\xf1ol"},{id:"fr",name:"Fran\xe7ais"},{id:"it",name:"Italiano"},{id:"hu",name:"Magyar"},{id:"nl",name:"Nederlands"},{id:"no",name:"Norsk"},{id:"pl",name:"Polski"},{id:"pt",name:"Portugu\xeas"},{id:"ro",name:"Rom\xe2nă"},{id:"sk",name:"Slovenčina"},{id:"fi",name:"Suomi"},{id:"sv",name:"Svenska"},{id:"tl",name:"Tagalog"},{id:"vi",name:"Tiếng Việt"},{id:"tr",name:"T\xfcrk\xe7e"},{id:"cs",name:"Čeština"},{id:"el",name:"Ελληνικά"},{id:"bg",name:"Български"},{id:"ru",name:"Русский"},{id:"uk",name:"ภาษาไทย"},{id:"zh",name:"中文"},{id:"zh-hk",name:"粵語"},{id:"ko",name:"한국어"},{id:"asl",name:"American Sign Language"},{id:"other",name:"その他"}],API_LIST:{CONTENT_CLASSIFICATION_LABELS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/content_classification_labels"},GAMES:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/games"},SCHEDULE:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/schedule"},POOL:{METHOD:"POST",ENDPOINT:"https://api.twitch.tv/helix/polls"},PREDICTIONS:{METHOD:"POST",ENDPOINT:"https://api.twitch.tv/helix/predictions"},USER:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/users"},CHAT:{CHATTERS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/chat/chatters"}},CHANNELS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/channels",PATCH:{METHOD:"PATCH",ENDPOINT:"https://api.twitch.tv/helix/channels"},FOLLOWERS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/channels/followers"}},STREAMS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/streams"},SEARCH:{CHANNELS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/search/channels"},CATEGORIES:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/search/categories"}},ANALYTICS:{GAME:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/analytics/games"}},EVENTSUB:{SUBSCRIPTIONS:{METHOD:"POST",ENDPOINT:"https://api.twitch.tv/helix/eventsub/subscriptions"}}},API_KEY:"of40zatnkd1ftcaqnf92ahqznkg1vn"},H=async()=>{let e=await T.settings.get("twitch_token");if(null==e)throw Error("twitch token is not found");return e.value},L=async(e,t)=>{let a=K(await H()),n=async a=>{if(!a.ok){let n=await a.json();throw Error("fetch error\n    ".concat(JSON.stringify({status:a.status,endpoint:e.ENDPOINT,params:t,response:n})))}},i=async()=>"GET"===e.METHOD?await a("".concat(e.ENDPOINT,"?").concat(R.Z.stringify(t)),{method:e.METHOD}):await a(e.ENDPOINT,{method:e.METHOD,body:JSON.stringify(t)}),r=await i();return n(r),await r.json().catch(()=>{})},k=async e=>await L(Z.STREAMS,e),M=async e=>{let t=await L(Z.CHANNELS.FOLLOWERS,e);if(null!=t.pagination.cursor){let a=await M({...e,after:t.pagination.cursor});return{...a,data:[...a.data,...t.data]}}return t},G=async e=>await L(Z.CHAT.CHATTERS,e),j=async e=>await L(Z.USER,e),B=async()=>await j({}),U=async e=>await L(Z.EVENTSUB.SUBSCRIPTIONS,e),K=e=>{let t={Authorization:"Bearer ".concat(e),"Client-Id":C,"Content-Type":"application/json"};return function(){for(var e=arguments.length,a=Array(e),n=0;n<e;n++)a[n]=arguments[n];let[i,r,...o]=a;return fetch(i,{...r,headers:{...t,...(null==r?void 0:r.headers)||{}}},...o)}},J=e=>{let t={method:"websocket",session_id:e};return{stream:{online:e=>({type:"stream.online",version:"1",condition:{broadcaster_user_id:e},transport:t}),ofline:e=>({type:"stream.offline",version:"1",condition:{broadcaster_user_id:e},transport:t})},channel:{update:e=>({type:"channel.update",version:"2",condition:{broadcaster_user_id:e},transport:t}),chat:{message:(e,a)=>({type:"channel.chat.message",version:"1",condition:{broadcaster_user_id:e,user_id:a},transport:t}),notification:(e,a)=>({type:"channel.chat.notification",version:"1",condition:{broadcaster_user_id:e,user_id:a},transport:t})},channel_points_automatic_reward:{add:e=>({type:"channel.channel_points_automatic_reward_redemption.add",version:"1",condition:{broadcaster_user_id:e},transport:t})},channel_points_custom_reward:{add:e=>({type:"channel.channel_points_custom_reward.add",version:"1",condition:{broadcaster_user_id:e},transport:t})},points_custom_reward_redemption:{add:(e,a)=>({type:"channel.channel_points_custom_reward_redemption.add",version:"1",condition:{broadcaster_user_id:e,rewardId:a},transport:t})},channel_points_automatic_reward_redemption:{add:e=>({type:"channel.channel_points_automatic_reward_redemption.add",version:"1",condition:{broadcaster_user_id:e},transport:t})}}}},F=e=>null!=e,z=async()=>{let e=await T.getMe();if(null==e){let e=(await B()).data[0],t={id:e.id,login:e.login};return await T.parameters.put({type:"me",value:t}),t}return e},V=async()=>{try{let e=await fetch("https://api.twitchinsights.net/v1/bots/all",{method:"GET"});return await e.json()}catch(e){return{bots:[],_total:0}}},W="SPAM_UPDATED_AT",Y=async()=>{let e=await T.settings.get(W);if((null==e?void 0:e.value)!=null&&!P({target:e.value,num:7,ago:"day"}))return;let t=await V();T.settings.put({id:W,value:new Date().toISOString()}),T.spam.bulkPut(t.bots.map(e=>({login:e[0]})))},q=async()=>{let e=await z(),t=(await k({user_id:e.id})).data[0];if(null==t){T.parameters.put({type:"live",value:{isLive:!1,startedAt:null,viewCount:0}});return}T.parameters.put({type:"live",value:{isLive:!0,startedAt:new Date(t.started_at),viewCount:t.viewer_count}})},X=async()=>{let e=await z();if(null==e)return;let[t,a]=await Promise.all([G({broadcaster_id:e.id,moderator_id:e.id}),T.getChatters()]),n=await T.spam.bulkGet(t.data.map(e=>e.user_login)).then(e=>e.map(e=>null==e?void 0:e.login)),i=t.data.sort((e,t)=>Number(e.user_id)-Number(t.user_id)).filter(e=>!n.includes(e.user_login));(i.length!==a.users.length||0!==i.filter(e=>!a.users.includes(e.user_id)).length||0!==a.users.filter(e=>!i.map(e=>e.user_id).includes(e)).length)&&T.parameters.put(l.parse({type:"chatters",value:{users:i.map(e=>e.user_id),total:i.length}}))},Q=async()=>{let e=await z(),t=(await T.followers.toArray()).filter(t=>t.channelId===e.id),a=await M({broadcaster_id:e.id,first:"100"}).then(t=>t.data.map(t=>({channelId:e.id,userId:t.user_id,followedAt:new Date(t.followed_at),updateAt:new Date,createdAt:new Date}))),n=t.map(e=>e.userId),i=a.map(e=>e.userId),r=t.filter(e=>!i.includes(e.userId)).map(e=>e.id).filter(F),o=a.filter(e=>!n.includes(e.userId));0!==r.length&&T.followers.bulkDelete(r),0!==o.length&&T.followers.bulkPut(o)},$=e=>(e<=0&&console.warn("keepalive timeout secondsは0以上の値である必要があります。"),e>=600&&console.warn("keepalive timeout secondsは600以下の値である必要があります。"),"".concat("wss://eventsub.wss.twitch.tv/ws","?keepalive_timeout_seconds=").concat(e)),ee=e=>(t,a)=>{let n=e=>{let n=JSON.parse(e.data);t===n.metadata.message_type&&a(n,e)};return e.addEventListener("message",n),n},et=e=>t=>{e.removeEventListener("message",t)},ea=e=>(t,a)=>{let n=e=>{let n=JSON.parse(e.data);"notification"===n.metadata.message_type&&n.metadata.subscription_type===t&&a(n,e)};return e.addEventListener("message",n),n};(n=null,{connect:async()=>{let e=new WebSocket($(30)),t=ea(e),a=ee(e),i=et(e);n=e;let r=await z();(async()=>{let e=J(await new Promise(e=>{let t=a("session_welcome",function(a){i(t),e(a.payload.session.id)})}));await Promise.all([U(e.channel.chat.message(r.id,r.id)),U(e.channel.update(r.id)),U(e.stream.online(r.id)),U(e.stream.ofline(r.id)),U(e.channel.channel_points_automatic_reward_redemption.add(r.id)),U(e.channel.channel_points_custom_reward.add(r.id)),U(e.channel.points_custom_reward_redemption.add(r.id))])})(),e.addEventListener("message",e=>{console.log(JSON.parse(e.data))}),t("channel.chat.message",e=>{let t={id:e.payload.event.message_id,userId:e.payload.event.chatter_user_id,channel:r.login,message:e.payload.event.message.text,messageType:"chat",fragments:e.payload.event.message.fragments,timestamp:Date.now(),rowdata:JSON.stringify(e),updateAt:new Date,createdAt:new Date};T.actions.add(t)}),t("channel.channel_points_automatic_reward_redemption.add",e=>{let t={id:e.payload.event.id,userId:e.payload.event.user_id,channel:r.login,userTitle:e.payload.event.reward.type,userInput:e.payload.event.user_input,rewardId:e.payload.event.reward.type,messageType:"atutomatic-reward",timestamp:Date.now(),rowdata:JSON.stringify(e),updateAt:new Date,createdAt:new Date};T.actions.add(t)}),t("channel.channel_points_custom_reward_redemption.add",e=>{let t={id:e.payload.event.id,userId:e.payload.event.user_id,channel:r.login,userTitle:e.payload.event.reward.title,userInput:e.payload.event.user_input,rewardId:e.payload.event.reward.id,messageType:"reward",timestamp:Date.now(),rowdata:JSON.stringify(e),updateAt:new Date,createdAt:new Date};T.actions.add(t)}),t("channel.update",e=>{let t={channelId:r.login,tpye:"update",broadcastTitle:e.payload.event.title,categoryId:e.payload.event.category_id,categoryName:e.payload.event.category_name,language:e.payload.event.language,timestamp:new Date,rowdata:JSON.stringify(e),updateAt:new Date,createdAt:new Date};T.channelHistories.put(s.parse(t))}),t("stream.offline",()=>q()),t("stream.online",()=>q())},close:()=>{null!=n&&(n.close(),n=null)}}).connect(),X(),Y(),Q(),q(),setInterval(()=>{X(),Y(),Q(),q()},1e4)}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}},n=!0;try{o[e].call(a.exports,a,a.exports,l),n=!1}finally{n&&delete s[e]}return a.exports}l.m=o,l.x=function(){var e=l.O(void 0,[214,440],function(){return l(77908)});return l.O(e)},e=[],l.O=function(t,a,n,i){if(a){i=i||0;for(var r=e.length;r>0&&e[r-1][2]>i;r--)e[r]=e[r-1];e[r]=[a,n,i];return}for(var o=1/0,r=0;r<e.length;r++){for(var a=e[r][0],n=e[r][1],i=e[r][2],s=!0,d=0;d<a.length;d++)o>=i&&Object.keys(l.O).every(function(e){return l.O[e](a[d])})?a.splice(d--,1):(s=!1,i<o&&(o=i));if(s){e.splice(r--,1);var c=n();void 0!==c&&(t=c)}}return t},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,{a:t}),t},l.d=function(e,t){for(var a in t)l.o(t,a)&&!l.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},l.f={},l.e=function(e){return Promise.all(Object.keys(l.f).reduce(function(t,a){return l.f[a](e,t),t},[]))},l.u=function(e){return 214===e?"static/chunks/214-839a4469207812ba.js":"static/chunks/"+e+".a79ed5139cfba474.js"},l.miniCssF=function(e){},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.tt=function(){return void 0===t&&(t={createScriptURL:function(e){return e}},"undefined"!=typeof trustedTypes&&trustedTypes.createPolicy&&(t=trustedTypes.createPolicy("nextjs#bundler",t))),t},l.tu=function(e){return l.tt().createScriptURL(e)},l.p="/twitch-comment-viewer-v1-frontend/_next/",a={908:1},l.f.i=function(e,t){a[e]||importScripts(l.tu(l.p+l.u(e)))},i=(n=self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push.bind(n),n.push=function(e){var t=e[0],n=e[1],r=e[2];for(var o in n)l.o(n,o)&&(l.m[o]=n[o]);for(r&&r(l);t.length;)a[t.pop()]=1;i(e)},r=l.x,l.x=function(){return Promise.all([l.e(214),l.e(440)]).then(r)},_N_E=l.x()}();