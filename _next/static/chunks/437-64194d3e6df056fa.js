"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[437],{8913:function(e,l,s){s.d(l,{R:function(){return i}});var t=s(57437),a=s(2265),n=s(97383);let r=e=>(0,t.jsxs)("div",{className:"flex flex-col gap-10 px-8 py-4 select-none",children:[(0,t.jsx)("p",{className:"text-large text-center",children:e.title}),(0,t.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,t.jsx)("button",{className:"btn btn-success",onClick:e.onSuccess,children:e.successText||"はい"}),(0,t.jsx)("button",{className:"btn btn-ghost",onClick:e.onFail,children:e.failText||"いいえ"})]})]}),i=()=>{let e=(0,n.v)();return{open:(0,a.useCallback)(l=>{let{onSuccess:s,onFail:a,...n}=l;e.open((0,t.jsx)(r,{...n,onFail:()=>{e.close(),null!=a&&a()},onSuccess:()=>{e.close(),null!=s&&s()}}))},[]),close:(0,a.useCallback)(()=>{e.close()},[])}}},44286:function(e,l,s){s.d(l,{default:function(){return m},t:function(){return x}});var t=s(57437),a=s(2265),n=s(91279),r=s(86578),i=s(67687),c=s(41789),d=s(62022),o=s(16603),u=s(22646);let x=e=>{let l=(0,c.j)(),s=(0,n.yR)(async()=>await i.db.broadcastTemplates.toArray(),[]),t=(0,d.Gq)(async()=>{if(null==s)return;let e=await Promise.all(s.map(async(e,s)=>{if(null==e.gameId)return;let t=await l.fetchById(e.gameId);if(null!=t)return{...e,templateIndex:s,tags:e.tags.join(","),gameTitle:t.name}}));return new r.Z(e,{keys:["broadcastTitle","tags","gameTitle"]})},[l,s]);return(0,a.useMemo)(()=>{if(null!=t&&null!=s)return t.search(e).map(e=>{var l;return s[(null===(l=e.item)||void 0===l?void 0:l.templateIndex)||0]})},[t,e,s])};function m(){let e=(0,u.l)([],{});return(0,t.jsxs)("div",{className:"flex flex-col h-full grow w-full",children:[(0,t.jsxs)("div",{className:"flex w-full justify-center mx-auto pt-6 pb-4 border-b items-center",children:[(0,t.jsx)("div",{className:"w-3/12 flex"}),(0,t.jsx)("div",{className:"w-5/12",children:(0,t.jsx)(o.ol,{})}),(0,t.jsx)("div",{className:"w-3/12 flex justify-end",children:(0,t.jsx)(o.zW,{})})]}),(0,t.jsx)("div",{className:"flex grow perfect-scrollbar z-0",ref:e.ref,children:(0,t.jsx)(o.Nd,{})})]})}},16603:function(e,l,s){s.d(l,{Nd:function(){return M},zW:function(){return q},ol:function(){return V},ZP:function(){return G}});var t=s(57437),a=s(2265),n=s(67688),r=s(44839),i=s(91279),c=s(59151),d=s(91825),o=s(62022),u=s(44286),x=s(22646),m=s(16463),h=s(39343),p=s(67687),f=s(13315),j=s(8913);let b=e=>(0,t.jsx)("span",{className:(0,r.Z)("badge",e.type,e.outline?"badge-outline":"",e.size),children:e.children});var g=s(11581);let v=e=>{let{name:l,control:s,rules:n}=e,r=(0,h.bc)({name:l,control:s,rules:n}),{fields:i,append:c,remove:d}=(0,h.Dq)({name:l,control:s,rules:n}),[o,u]=(0,a.useState)(""),x=e=>{d(e)};return(0,t.jsxs)("div",{className:"inline-flex flex-col gap-2",children:[(0,t.jsxs)("span",{className:"inline-flex gap-2",children:[(0,t.jsx)("input",{className:"input input-bordered w-64",type:"text",value:o,onChange:e=>{u(e.currentTarget.value)},disabled:e.disabled}),(0,t.jsx)("button",{type:"button",className:"btn",onClick:()=>{""===o||null==o||r.field.value.includes(o)||(c(o),u(""))},children:"追加"})]}),(0,t.jsx)("ul",{className:"flex gap-1 select-none flex-wrap",children:i.map((e,l)=>(0,t.jsx)("li",{children:(0,t.jsx)(b,{size:"badge-lg",type:"badge-ghost",children:(0,t.jsxs)("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[r.field.value[l],(0,t.jsx)("input",{type:"hidden",...r.field}),(0,t.jsx)("label",{className:"cursor-pointer",onClick:()=>x(l),children:(0,t.jsx)(g.U.CROSS.SIZE,{size:15})})]})})},e.id))})]})};var N=s(41789);let w=e=>l=>e.replace("{width}",l.width.toString()).replace("{height}",l.height.toString());var y=s(12853);let C=(0,a.createContext)(null),k=()=>(0,a.useContext)(C),T=e=>{let l=(0,N.j)(),s=(0,i.yR)(async()=>{if(null!=e.id)return await l.fetchById(e.id)},[e.id]);return(0,t.jsx)(C.Provider,{value:s,children:e.children})},I=(0,y.kQ)(k,["name"]),S=((0,y.RY)(k,["updateAt"]),(0,y.RY)(k,["createdAt"]),e=>{let l=k(),s=(0,a.useMemo)(()=>w((null==l?void 0:l.box_art_url)||"https://static-cdn.jtvnw.net/ttv-static/404_boxart-{width}x{height}.jpg")({width:Number(e.width)||300,height:Math.round(Number((Number(e.width)||300)/3*4))}),[l]);return(0,t.jsx)("img",{...e,src:s,alt:null==l?void 0:l.name})}),R={Provider:T,Name:I,Image:S,Search:e=>{let[l,s]=(0,o.Gl)(),[n,i]=(0,a.useState)(null),c=(0,a.useCallback)(l=>{if(null!=e.onChange){if(null==l.currentTarget.dataset.game)throw Error("not found game");e.onChange(l.currentTarget.dataset.game)}},[e.onChange]),d=(0,o.Nr)(500,async e=>{if(""===e||null==e)return null;i(await (0,f.sT)({query:e}))},[]);(0,a.useEffect)(()=>{d(l)},[l]);let u=(0,x.l)([n]);return(0,t.jsx)("div",{className:"h-96",children:(0,t.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,t.jsx)("input",{type:"text",placeholder:"Type here",className:"input input-bordered w-full max-w-xs",value:l,onChange:s}),(0,t.jsx)("div",{className:(0,r.Z)("w-full border h-80 perfect-scrollbar bg-base-100"),ref:u.ref,children:null!=n?(0,t.jsx)("ul",{className:"flex flex-col gap-2 menu",children:n.map(e=>(0,t.jsx)("li",{"data-game":e.id,onClick:c,tabIndex:0,children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("img",{className:"aspect-square object-cover rounded-btn border-2",src:e.box_art_url,alt:e.id,width:52}),(0,t.jsx)("p",{className:" text-sm",children:e.name})]})},e.id))}):null})]})})},Input:e=>{let l=(0,a.useRef)(null),s=(0,a.useRef)(null),n=(0,a.useCallback)(()=>{var e;null===(e=s.current)||void 0===e||e.showModal()},[s.current]),r=(0,a.useCallback)(t=>{var a;null===(a=s.current)||void 0===a||a.close(),console.log(s.current),null!=e.onChange&&null!=l.current&&(l.current.value=t,l.current.dispatchEvent(new Event("input",{bubbles:!0})))},[e.onChange]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:" inline-flex cursor-pointer items-center gap-4 border dasy-rounded rounded-btn p-2 ",onClick:n,children:[(0,t.jsx)("input",{type:"hidden",onInput:e.onChange,ref:l,name:e.name}),(0,t.jsx)(T,{id:e.value,children:(0,t.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[(0,t.jsx)(S,{className:"w-12 h-12 object-cover overflow-hidden rounded-btn border-2"}),(0,t.jsx)(I,{className:"font-bold",children:"ゲーム未選択"}),(0,t.jsx)("div",{className:"text-info",children:g.U.SEARCH})]})})]}),(0,t.jsxs)("dialog",{className:"modal",ref:s,children:[(0,t.jsx)("div",{className:"modal-box h-min",children:(0,t.jsx)(R.Search,{onChange:r})}),(0,t.jsx)("label",{className:"modal-backdrop",children:(0,t.jsx)("button",{children:"close"})})]})]})}},P=(0,a.createContext)(null),_=()=>(0,a.useContext)(P),B=(0,y.kQ)(_,["broadcastTitle"]),E=((0,y.RY)(_,["createdAt"]),(0,y.RY)(_,["updateAt"]),()=>{let e=_(),l=(0,j.R)();return(0,a.useCallback)(async()=>{l.open({title:"配信に適用しますか？",onSuccess:async()=>{let l=await p.db.getMe();null!=e&&(null==l?void 0:l.id)!=null&&await (0,f.Xh)({id:{broadcaster_id:l.id},patch:{game_id:e.gameId,broadcaster_language:e.language,title:e.broadcastTitle,tags:e.tags,content_classification_labels:e.classificationLabels,is_branded_content:e.isBrandedContent}})}})},[e])}),z=()=>{let e=_(),l=(0,j.R)();return(0,a.useCallback)(async()=>{l.open({title:"このテンプレートを削除しますか？",onSuccess:async()=>{(null==e?void 0:e.id)!=null&&await (0,c.uM)([e.id])}})},[e])},Z=()=>{let e=_(),l=(0,m.useRouter)();return(0,a.useCallback)(()=>{l.push("/games/edit?templateId=".concat(null==e?void 0:e.id))},[e,l])},A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=_(),s=(0,m.useRouter)();return(0,a.useCallback)(()=>{if(e.isNew){s.push("/games/create");return}s.push("/games/create?templateId=".concat(null==l?void 0:l.id))},[l,s])},F=()=>(0,h.Gc)(),Y={Provider:e=>(0,t.jsx)(P.Provider,{value:e.data,children:e.children}),Title:B,TagBadge:e=>{let l=_();return(0,t.jsx)("ul",{...e,children:null==l?void 0:l.tags.map(e=>(0,t.jsx)(b,{size:"badge-sm",children:e},e))})},Favorite:e=>{let l=_(),s=(0,a.useCallback)(e=>{if((null==l?void 0:l.id)==null)throw Error("not found props id");(0,c.Id)(l.id,{favorite:e.currentTarget.checked})},[l]);return(null==l?void 0:l.favorite)==null?(0,t.jsx)("input",{...e,type:"checkbox",className:"favorite"}):(0,t.jsx)("input",{...e,type:"checkbox",defaultChecked:l.favorite,className:"favorite",onInput:s})},Apply:e=>{let l=E();return(0,t.jsx)("button",{className:"btn btn-sm btn-accent",onClick:l,...e,type:"button",children:"適用"})},Edit:e=>{let l=Z();return(0,t.jsx)("button",{className:"btn btn-sm",onClick:l,...e,type:"button",children:"編集"})},Delete:e=>{let l=z();return(0,t.jsx)("button",{className:"btn btn-sm btn-ghost",onClick:l,...e,type:"button",children:"削除"})},Copy:e=>{let l=A();return(0,t.jsx)("button",{className:"btn btn-sm",onClick:l,...e,type:"button",children:"複製"})},uses:{useApply:E,useDelete:z,useEdit:Z,useCreate:A},editor:{BroadcastFormProvider:e=>{let{children:l,onSubmit:s}=e,a=_(),n=(0,h.cI)({defaultValues:{...a}});return(0,t.jsx)(h.RV,{...n,children:(0,t.jsx)("form",{...e,onSubmit:n.handleSubmit(s),children:l})})},Title:()=>{let{register:e}=F();return(0,t.jsx)("input",{className:"input input-bordered w-full max-w-xs",type:"text",...e("broadcastTitle")})},Language:()=>{let{register:e}=F();return(0,t.jsxs)("select",{className:" select select-bordered",...e("language"),children:[(0,t.jsx)("option",{disabled:!0,children:"選択言語"}),f.PK.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})},BrandedContents:()=>{let{register:e}=F();return(0,t.jsx)("input",{type:"checkbox",className:"ios-toggle",...e("isBrandedContent")})},ClassificationLables:()=>{let{register:e}=F();return(0,t.jsx)(t.Fragment,{children:f.Ag.map(l=>(0,t.jsxs)("div",{className:" inline-flex gap-2 justify-center",children:[(0,t.jsx)("input",{type:"checkbox",value:l.id,...e("classificationLabels")},l.id),(0,t.jsx)("span",{children:l.description})]},l.id))})},Tags:()=>{let{control:e}=F();return(0,t.jsx)(v,{control:e,name:"tags"})},Game:()=>{let{setValue:e,getValues:l}=F(),[s,n]=(0,a.useState)(l("gameId"));return(0,t.jsx)(R.Input,{value:s,onChange:l=>{e("gameId",l.currentTarget.value),n(l.currentTarget.value)}})}}},D=()=>(0,t.jsxs)("div",{className:"relative z-0 w-full",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 z-20 mt-2 mr-3",children:(0,t.jsx)(Y.Favorite,{})}),(0,t.jsx)("div",{className:"z-10 absolute top-0 w-full h-full bg-neutral text-neutral-content bg-opacity-80 opacity-0 hover:opacity-100 transition-opacity rounded-box overflow-hidden",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-5 h-full w-full p-10",children:[(0,t.jsx)(Y.Apply,{}),(0,t.jsx)(Y.Copy,{}),(0,t.jsx)(Y.Edit,{}),(0,t.jsx)(Y.Delete,{})]})}),(0,t.jsxs)("div",{className:"card w-full bg-base-100 shadow-xl image-full z-0 aspect-square h-full",children:[(0,t.jsx)("figure",{children:(0,t.jsx)(R.Image,{className:" object-cover",width:500})}),(0,t.jsxs)("div",{className:"card-body",children:[(0,t.jsx)("h2",{className:"card-title w-full",children:(0,t.jsx)(R.Name,{className:" break-all line-clamp-2 w-full"})}),(0,t.jsx)("p",{children:(0,t.jsx)(Y.Title,{})}),(0,t.jsx)(Y.TagBadge,{className:"flex justify-end gap-2 flex-wrap"})]})]})]});function M(){let e=(0,i.yR)(async()=>(await (0,c.oV)()).filter(d.h.notNull),[]),l=(0,i.yR)(async()=>(await (0,c.oV)({type:"favorite",value:!0})).filter(d.h.notNull),[]);return(0,t.jsxs)("div",{className:"p-10 h-fit flex flex-col gap-5 w-full",children:[(0,t.jsx)("h2",{className:"heading-2",children:"お気に入り"}),(0,t.jsx)("div",{className:"flex items-stretch flex-wrap -m-3",children:null==l?void 0:l.map(e=>(0,t.jsx)("div",{className:" w-1/4 flex p-3 min-w-60 max-w-96",children:(0,t.jsx)(Y.Provider,{data:e,children:(0,t.jsx)(R.Provider,{id:e.gameId,children:(0,t.jsx)(D,{})})})},e.id))}),(0,t.jsx)("h2",{className:"heading-2",children:"全件"}),(0,t.jsx)("div",{className:"flex items-stretch flex-wrap -m-3",children:null==e?void 0:e.map(e=>(0,t.jsx)("div",{className:" w-1/5 flex p-3 min-w-60 max-w-96",children:(0,t.jsx)(Y.Provider,{data:e,children:(0,t.jsx)(R.Provider,{id:e.gameId,children:(0,t.jsx)(D,{})})})},e.id))})]})}function G(e){return(0,t.jsx)(Y.Provider,{data:e.value,children:(0,t.jsx)(Y.editor.BroadcastFormProvider,{onSubmit:l=>{let s=n.X.parse(l);e.onCommit&&e.onCommit(s)},className:"w-full",children:(0,t.jsxs)("div",{className:"flex flex-col gap-5 py-4 px-10",children:[(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("p",{className:"w-48",children:"配信タイトル"}),(0,t.jsx)(Y.editor.Title,{})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("p",{className:"w-48",children:"対象ゲーム"}),(0,t.jsx)(Y.editor.Game,{})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("p",{className:"w-48",children:"タグ"}),(0,t.jsx)(Y.editor.Tags,{})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("p",{className:"w-48",children:"配信言語"}),(0,t.jsx)(Y.editor.Language,{})]}),(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("p",{className:"w-48",children:"ブランドコンテンツ"}),(0,t.jsx)(Y.editor.BrandedContents,{})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{className:"btn btn-error",type:"button",onClick:e.onCancel,children:e.canncelLabel||"キャンセル"}),(0,t.jsx)("button",{className:"btn btn-success",children:e.commmitLabel||"完了"})]})]})})})}let L=()=>{let[e,l]=(0,a.useState)("close");return(0,t.jsxs)(t.Fragment,{children:["open"===e?(0,t.jsxs)("dialog",{className:"modal modal-open",children:[(0,t.jsxs)("div",{className:" modal-box",children:[(0,t.jsx)(Y.Apply,{}),(0,t.jsx)(Y.Copy,{}),(0,t.jsx)(Y.Edit,{}),(0,t.jsx)(Y.Delete,{})]}),(0,t.jsx)("label",{className:"modal-backdrop",onClick:()=>l("close")})]}):null,(0,t.jsxs)("li",{className:"flex gap-2 items-center cursor-pointer px-5 py-4 hover:bg-base-200 rounded-box",onClick:()=>l("open"),children:[(0,t.jsx)("div",{children:(0,t.jsx)(R.Image,{width:60,className:" rounded-box aspect-square object-cover"})}),(0,t.jsxs)("div",{className:"flex flex-col grow",children:[(0,t.jsx)(R.Name,{className:"text-md font-extralight"}),(0,t.jsx)(Y.Title,{className:"text-lg"})]}),(0,t.jsx)("div",{children:(0,t.jsx)(Y.TagBadge,{})})]})]})},q=()=>{let e=Y.uses.useCreate({isNew:!0});return(0,t.jsx)("div",{className:"inline-flex items-center gap-3",children:(0,t.jsx)("button",{className:"btn btn-outline btn-success btn-xs",onClick:e,children:"新規追加"})})},V=()=>{let[e,l]=(0,o.Gl)(""),s=(0,x.l)([]),a=(0,u.t)(e);return(0,t.jsxs)("div",{className:(0,r.Z)("flex items-center dropdown dropdown-bottom dropdown-hover w-full",{"[&>input]:hover:rounded-b-none":!(null==a||0==a.length)}),children:[(0,t.jsx)("input",{className:(0,r.Z)("input input-bordered input-sm input-ghost grow bg-base-100 text-base-content rounded-lg",{"focus:rounded-b-none":!(null==a||0==a.length)}),value:e,onChange:l,placeholder:"検索"}),(0,t.jsx)("div",{className:(0,r.Z)("dropdown-content z-10 bg-base-100 shadow-2xl w-full h-max max-h-96 perfect-scrollbar border-x rounded-b-lg",{"border-b":!(null==a||0==a.length)}),ref:s.ref,children:null==a||0==a.length?null:(0,t.jsx)("ul",{className:"flex flex-wrap gap-2 flex-col p-2",children:a.map(e=>(0,t.jsx)(Y.Provider,{data:e,children:(0,t.jsx)(R.Provider,{id:e.gameId,children:(0,t.jsx)(L,{})})},e.id))})})]})}},12853:function(e,l,s){s.d(l,{RY:function(){return i},kQ:function(){return r},uB:function(){return c}});var t=s(57437);s(2265);var a=s(44839),n=s(23332);let r=(e,l,s)=>a=>{let n=e();if(null==n)return(0,t.jsx)("span",{...s,...a});let r=l.map(e=>n[e]).find(e=>null!=e);switch(typeof r){case"bigint":case"boolean":case"number":case"string":return(0,t.jsx)("span",{...s,...a,children:r.toString()});default:throw Error("")}},i=(e,l,s)=>a=>{let r=e();if(null==r)return(0,t.jsx)("time",{...s,...a});let i=l.map(e=>r[e]).find(e=>null!=e);switch(typeof i){case"number":case"string":case"object":if(!(i instanceof Date)||!n.B.isDayjs(i))return;return(0,t.jsx)("time",{...s,...a,children:(0,n.B)(i).format(a.format||"YYYY/MM/DD hh:mm:ss")});default:throw Error("")}},c=(e,l,s,n)=>r=>{let i=e();if(null==i)return(0,t.jsx)("img",{...n,...r,className:(0,a.Z)(null==n?void 0:n.className,r.className),src:s.src,alt:s.alt});let c=l.src.map(e=>i[e]).find(e=>null!=e),d=l.alt.map(e=>i[e]).find(e=>null!=e);return"string"==typeof c&&"string"==typeof d?(0,t.jsx)("img",{...n,...r,className:(0,a.Z)(null==n?void 0:n.className,r.className),src:c,alt:d}):(0,t.jsx)("img",{...n,...r,className:(0,a.Z)(null==n?void 0:n.className,r.className),src:s.src,alt:s.alt})}},41789:function(e,l,s){s.d(l,{GameContextProvider:function(){return r},j:function(){return n}});var t=s(59151);let a=(0,s(39813).a)({fetcher:t.m7,idKey:"id"}),n=a.useContext,r=a.Provider}}]);