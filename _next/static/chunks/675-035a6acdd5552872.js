"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[675],{8913:function(e,l,s){s.d(l,{R:function(){return i}});var a=s(57437),t=s(2265),n=s(97383);let r=e=>(0,a.jsxs)("div",{className:"flex flex-col gap-10 px-8 py-4 select-none",children:[(0,a.jsx)("p",{className:"text-large text-center",children:e.title}),(0,a.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,a.jsx)("button",{className:"btn btn-success",onClick:e.onSuccess,children:e.successText||"はい"}),(0,a.jsx)("button",{className:"btn btn-ghost",onClick:e.onFail,children:e.failText||"いいえ"})]})]}),i=()=>{let e=(0,n.v)();return{open:(0,t.useCallback)(l=>{let{onSuccess:s,onFail:t,...n}=l;e.open((0,a.jsx)(r,{...n,onFail:()=>{e.close(),null!=t&&t()},onSuccess:()=>{e.close(),null!=s&&s()}}))},[]),close:(0,t.useCallback)(()=>{e.close()},[])}}},44286:function(e,l,s){s.d(l,{default:function(){return m},t:function(){return x}});var a=s(57437),t=s(2265),n=s(91279),r=s(86578),i=s(67687),c=s(41789),d=s(62022),o=s(48494),u=s(22646);let x=e=>{let l=(0,c.j)(),s=(0,n.yR)(async()=>await i.db.broadcastTemplates.toArray(),[]),a=(0,d.Gq)(async()=>{if(null==s)return;let e=await Promise.all(s.map(async(e,s)=>{if(null==e.gameId)return;let a=await l.fetchById(e.gameId);if(null!=a)return{...e,templateIndex:s,tags:e.tags.join(","),gameTitle:a.name}}));return new r.Z(e,{keys:["broadcastTitle","tags","gameTitle"]})},[l,s]);return(0,t.useMemo)(()=>{if(null!=a&&null!=s)return a.search(e).map(e=>{var l;return s[(null===(l=e.item)||void 0===l?void 0:l.templateIndex)||0]})},[a,e,s])};function m(){let e=(0,u.l)([],{});return(0,a.jsxs)("div",{className:"flex flex-col h-full grow w-full",children:[(0,a.jsxs)("div",{className:"flex w-full justify-center mx-auto pt-6 pb-4 border-b items-center",children:[(0,a.jsx)("div",{className:"w-3/12 flex"}),(0,a.jsx)("div",{className:"w-5/12",children:(0,a.jsx)(o.ol,{})}),(0,a.jsx)("div",{className:"w-3/12 flex justify-end",children:(0,a.jsx)(o.zW,{})})]}),(0,a.jsx)("div",{className:"flex grow perfect-scrollbar z-0",ref:e.ref,children:(0,a.jsx)(o.Nd,{})})]})}},48494:function(e,l,s){s.d(l,{Nd:function(){return L},zW:function(){return K},ol:function(){return Q},ZP:function(){return q}});var a=s(57437),t=s(2265),n=s(67688),r=s(44839),i=s(91279),c=s(59151),d=s(91825),o=s(62022),u=s(44286),x=s(22646),m=s(16463),h=s(31014),f=s(39343),p=s(67687),j=s(82876),b=s(8913);let g=e=>(0,a.jsx)("span",{className:(0,r.Z)("badge",e.type,e.outline?"badge-outline":"",e.size),children:e.children});var v=s(53731),N=s(11581);let w=e=>{let{name:l,control:s,rules:n}=e,r=(0,f.bc)({name:l,control:s,rules:n}),{fields:i,append:c,remove:d}=(0,f.Dq)({name:l,control:s,rules:n}),[o,u]=(0,t.useState)(""),x=()=>{""===o||null==o||r.field.value.includes(o)||(c(o),u(""))},m=e=>{d(e)},h=(0,t.useCallback)(e=>{if(e.key===v.sd.ENTER){e.preventDefault(),e.stopPropagation(),console.log("add enter"),x();return}},[x]);return(0,a.jsxs)("div",{className:"inline-flex flex-col gap-2",children:[(0,a.jsxs)("span",{className:"inline-flex gap-2",children:[(0,a.jsx)("input",{className:"input input-bordered w-64",type:"text",value:o,onChange:e=>{u(e.currentTarget.value)},onKeyDown:h,disabled:e.disabled}),(0,a.jsx)("button",{type:"button",className:"btn",onClick:x,children:"追加"})]}),(0,a.jsx)("ul",{className:"flex gap-1 select-none flex-wrap",children:i.map((e,l)=>(0,a.jsx)("li",{children:(0,a.jsx)(g,{size:"badge-lg",type:"badge-ghost",children:(0,a.jsxs)("span",{className:"flex items-center gap-1 whitespace-nowrap",children:[r.field.value[l],(0,a.jsx)("input",{type:"hidden",...r.field}),(0,a.jsx)("label",{className:"cursor-pointer",onClick:()=>m(l),children:(0,a.jsx)(N.U.CROSS.SIZE,{size:15})})]})})},e.id))})]})};var y=s(41789);let C=e=>l=>e.replace("{width}",l.width.toString()).replace("{height}",l.height.toString());var k=s(12853);let T=(0,t.createContext)(null),I=()=>(0,t.useContext)(T),S=e=>{let l=(0,y.j)(),s=(0,i.yR)(async()=>{if(null!=e.id)return await l.fetchById(e.id)},[e.id]);return(0,a.jsx)(T.Provider,{value:s,children:e.children})},Z=(0,k.kQ)(I,["name"]),R=((0,k.RY)(I,["updateAt"]),(0,k.RY)(I,["createdAt"]),e=>{let l=I(),s=(0,t.useMemo)(()=>C((null==l?void 0:l.box_art_url)||"https://static-cdn.jtvnw.net/ttv-static/404_boxart-{width}x{height}.jpg")({width:Number(e.width)||300,height:Math.round(Number((Number(e.width)||300)/3*4))}),[l]);return(0,a.jsx)("img",{...e,src:s,alt:null==l?void 0:l.name})}),P={Provider:S,Name:Z,Image:R,Search:e=>{let[l,s]=(0,o.Gl)(),[n,i]=(0,t.useState)(null),c=(0,t.useCallback)(l=>{if(null!=e.onChange){if(null==l.currentTarget.dataset.game)throw Error("not found game");e.onChange(l.currentTarget.dataset.game)}},[e.onChange]),d=(0,o.Nr)(500,async e=>{if(""===e||null==e)return null;i(await (0,j.sT)({query:e}))},[]);(0,t.useEffect)(()=>{d(l)},[l]);let u=(0,x.l)([n]);return(0,a.jsx)("div",{className:"h-96",children:(0,a.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,a.jsx)("input",{type:"text",placeholder:"Type here",className:"input input-bordered w-full max-w-xs",value:l,onChange:s}),(0,a.jsx)("div",{className:(0,r.Z)("w-full border h-80 perfect-scrollbar bg-base-100"),ref:u.ref,children:null!=n?(0,a.jsx)("ul",{className:"flex flex-col gap-2 menu",children:n.map(e=>(0,a.jsx)("li",{"data-game":e.id,onClick:c,tabIndex:0,children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("img",{className:"aspect-square object-cover rounded-btn border-2",src:e.box_art_url,alt:e.id,width:52}),(0,a.jsx)("p",{className:" text-sm",children:e.name})]})},e.id))}):null})]})})},Input:e=>{let l=(0,t.useRef)(null),s=(0,t.useRef)(null),n=(0,t.useCallback)(()=>{var e;null===(e=s.current)||void 0===e||e.showModal()},[s.current]),r=(0,t.useCallback)(a=>{var t;null===(t=s.current)||void 0===t||t.close(),console.log(s.current),null!=e.onChange&&null!=l.current&&(l.current.value=a,l.current.dispatchEvent(new Event("input",{bubbles:!0})))},[e.onChange]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:" inline-flex cursor-pointer items-center gap-4 border dasy-rounded rounded-btn p-2 ",onClick:n,children:[(0,a.jsx)("input",{type:"hidden",onInput:e.onChange,ref:l,name:e.name}),(0,a.jsx)(S,{id:e.value,children:(0,a.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[(0,a.jsx)(R,{className:"w-12 h-12 object-cover overflow-hidden rounded-btn border-2"}),(0,a.jsx)(Z,{className:"font-bold",children:"ゲーム未選択"}),(0,a.jsx)("div",{className:"text-info",children:N.U.SEARCH})]})})]}),(0,a.jsxs)("dialog",{className:"modal",ref:s,children:[(0,a.jsx)("div",{className:"modal-box h-min",children:(0,a.jsx)(P.Search,{onChange:r})}),(0,a.jsx)("label",{className:"modal-backdrop",children:(0,a.jsx)("button",{children:"close"})})]})]})}},E=(0,t.createContext)(null),_=()=>(0,t.useContext)(E),B=(0,k.kQ)(_,["broadcastTitle"]),z=((0,k.RY)(_,["createdAt"]),(0,k.RY)(_,["updateAt"]),()=>{let e=_(),l=(0,b.R)();return(0,t.useCallback)(async()=>{l.open({title:"配信に適用しますか？",onSuccess:async()=>{let l=await p.db.getMe();null!=e&&(null==l?void 0:l.id)!=null&&await (0,j.Xh)({id:{broadcaster_id:l.id},patch:{game_id:e.gameId,broadcaster_language:e.language,title:e.broadcastTitle,tags:e.tags,content_classification_labels:e.classificationLabels,is_branded_content:e.isBrandedContent}})}})},[e])}),A=()=>{let e=_(),l=(0,b.R)();return(0,t.useCallback)(async()=>{l.open({title:"このテンプレートを削除しますか？",onSuccess:async()=>{(null==e?void 0:e.id)!=null&&await (0,c.uM)([e.id])}})},[e])},D=()=>{let e=_(),l=(0,m.useRouter)();return(0,t.useCallback)(()=>{l.push("/games/edit?templateId=".concat(null==e?void 0:e.id))},[e,l])},F=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=_(),s=(0,m.useRouter)();return(0,t.useCallback)(()=>{if(e.isNew){s.push("/games/create");return}s.push("/games/create?templateId=".concat(null==l?void 0:l.id))},[l,s])},Y=()=>(0,f.Gc)(),M={Provider:e=>(0,a.jsx)(E.Provider,{value:e.data,children:e.children}),Title:B,TagBadge:e=>{let l=_();return(0,a.jsx)("ul",{...e,children:null==l?void 0:l.tags.map(e=>(0,a.jsx)(g,{size:"badge-sm",children:e},e))})},Favorite:e=>{let l=_(),s=(0,t.useCallback)(e=>{if((null==l?void 0:l.id)==null)throw Error("not found props id");(0,c.Id)(l.id,{favorite:e.currentTarget.checked})},[l]);return(null==l?void 0:l.favorite)==null?(0,a.jsx)("input",{...e,type:"checkbox",className:"favorite"}):(0,a.jsx)("input",{...e,type:"checkbox",defaultChecked:l.favorite,className:"favorite text-outline",onInput:s})},Apply:e=>{let l=z();return(0,a.jsx)("button",{className:"btn btn-sm btn-accent",onClick:l,...e,type:"button",children:"適用"})},Edit:e=>{let l=D();return(0,a.jsx)("button",{className:"btn btn-sm",onClick:l,...e,type:"button",children:"編集"})},Delete:e=>{let l=A();return(0,a.jsx)("button",{className:"btn btn-sm btn-ghost",onClick:l,...e,type:"button",children:"削除"})},Copy:e=>{let l=F();return(0,a.jsx)("button",{className:"btn btn-sm",onClick:l,...e,type:"button",children:"複製"})},uses:{useApply:z,useDelete:A,useEdit:D,useCreate:F},editor:{BroadcastFormProvider:e=>{let{children:l,onSubmit:s}=e,t=_(),r=(0,f.cI)({mode:"onChange",defaultValues:{...t},resolver:(0,h.F)(n.X)});return(0,a.jsx)(f.RV,{...r,children:(0,a.jsx)("form",{...e,onSubmit:r.handleSubmit(s),children:l})})},Title:()=>{var e;let l=Y();return(0,a.jsxs)("div",{className:"inline-flex flex-col",children:[(0,a.jsx)("input",{className:"input input-bordered w-full max-w-xs",type:"text",...l.register("broadcastTitle")}),(0,a.jsxs)("p",{className:"text-error select-none",children:[null===(e=l.formState.errors.broadcastTitle)||void 0===e?void 0:e.message," \xa0"]})]})},Language:()=>{let{register:e}=Y();return(0,a.jsxs)("select",{className:" select select-bordered",...e("language"),children:[(0,a.jsx)("option",{disabled:!0,children:"選択言語"}),j.PK.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})},BrandedContents:()=>{let{register:e}=Y();return(0,a.jsx)("input",{type:"checkbox",className:"ios-toggle",...e("isBrandedContent")})},ClassificationLables:()=>{let{register:e}=Y();return(0,a.jsx)(a.Fragment,{children:j.Ag.map(l=>(0,a.jsxs)("div",{className:" inline-flex gap-2 justify-center",children:[(0,a.jsx)("input",{type:"checkbox",value:l.id,...e("classificationLabels")},l.id),(0,a.jsx)("span",{children:l.description})]},l.id))})},Tags:()=>{var e;let l=Y();return(0,a.jsxs)("div",{className:"inline-flex flex-col",children:[(0,a.jsx)(w,{control:l.control,name:"tags"}),(0,a.jsxs)("p",{className:"text-error select-none",children:[null===(e=l.formState.errors.tags)||void 0===e?void 0:e.message," \xa0"]})]})},Game:()=>{let{setValue:e,getValues:l}=Y(),[s,n]=(0,t.useState)(l("gameId"));return(0,a.jsx)(P.Input,{value:s,onChange:l=>{e("gameId",l.currentTarget.value),n(l.currentTarget.value)}})}}},G=()=>{let e=(0,r.Z)("inline-block h-full w-full font-black border-[2vw] border-neutral blur-3xl"),l=(0,r.Z)("opacity-40 hover:opacity-100 transition-opacity drop-shadow-sm text-outline");return(0,a.jsxs)("div",{className:"relative z-0 w-full indicator",children:[(0,a.jsx)("div",{className:"indicator-item z-20",children:(0,a.jsx)(M.Favorite,{})}),(0,a.jsxs)("div",{className:"z-10 absolute top-0 w-full h-full opacity-0 hover:opacity-100 transition-opacity overflow-hidden rounded-box backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"w-full h-full grid grid-cols-2 grid-rows-2 font-bold absolute top-0",children:[(0,a.jsx)("div",{className:(0,r.Z)("bg-success",e)}),(0,a.jsx)("div",{className:(0,r.Z)("bg-accent",e)}),(0,a.jsx)("div",{className:(0,r.Z)("bg-info",e)}),(0,a.jsx)("div",{className:(0,r.Z)("bg-error",e)})]}),(0,a.jsxs)("div",{className:"z-20 absolute top-0 w-full h-full grid grid-cols-2 grid-rows-2 font-bold text-2xl",children:[(0,a.jsx)(M.Apply,{className:(0,r.Z)("text-success",l)}),(0,a.jsx)(M.Copy,{className:(0,r.Z)("text-accent",l)}),(0,a.jsx)(M.Edit,{className:(0,r.Z)("text-info",l)}),(0,a.jsx)(M.Delete,{className:(0,r.Z)("text-error",l)})]})]}),(0,a.jsxs)("div",{className:"card w-full bg-base-100 shadow-xl image-full z-0 aspect-square h-full",children:[(0,a.jsx)("figure",{children:(0,a.jsx)(P.Image,{className:" object-cover",width:500})}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsx)("h2",{className:"card-title w-full",children:(0,a.jsx)(P.Name,{className:" break-all line-clamp-2 w-full"})}),(0,a.jsx)("p",{children:(0,a.jsx)(M.Title,{})}),(0,a.jsx)(M.TagBadge,{className:"flex justify-end gap-2 flex-wrap"})]})]})]})};function L(){let e=(0,i.yR)(async()=>(await (0,c.oV)()).filter(d.h.notNull),[]),l=(0,i.yR)(async()=>(await (0,c.oV)({type:"favorite",value:!0})).filter(d.h.notNull),[]);return(0,a.jsxs)("div",{className:"p-10 h-fit flex flex-col gap-5 w-full",children:[(0,a.jsx)("h2",{className:"heading-2",children:"お気に入り"}),(0,a.jsx)("div",{className:"flex items-stretch flex-wrap -m-3",children:null==l?void 0:l.map(e=>(0,a.jsx)("div",{className:" w-1/4 flex p-3 min-w-60 max-w-96",children:(0,a.jsx)(M.Provider,{data:e,children:(0,a.jsx)(P.Provider,{id:e.gameId,children:(0,a.jsx)(G,{})})})},e.id))}),(0,a.jsx)("h2",{className:"heading-2",children:"全件"}),(0,a.jsx)("div",{className:"flex items-stretch flex-wrap -m-3",children:null==e?void 0:e.map(e=>(0,a.jsx)("div",{className:" w-1/5 flex p-3 min-w-60 max-w-96",children:(0,a.jsx)(M.Provider,{data:e,children:(0,a.jsx)(P.Provider,{id:e.gameId,children:(0,a.jsx)(G,{})})})},e.id))})]})}function q(e){return(0,a.jsx)(M.Provider,{data:e.value,children:(0,a.jsx)(M.editor.BroadcastFormProvider,{onSubmit:l=>{let s=n.X.parse(l);e.onCommit&&e.onCommit(s)},className:"w-full",children:(0,a.jsxs)("div",{className:"flex flex-col gap-5 py-4 px-10",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("p",{className:"w-48",children:"配信タイトル"}),(0,a.jsx)(M.editor.Title,{})]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("p",{className:"w-48",children:"対象ゲーム"}),(0,a.jsx)(M.editor.Game,{})]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("p",{className:"w-48",children:"タグ"}),(0,a.jsx)(M.editor.Tags,{})]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("p",{className:"w-48",children:"配信言語"}),(0,a.jsx)(M.editor.Language,{})]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("p",{className:"w-48",children:"ブランドコンテンツ"}),(0,a.jsx)(M.editor.BrandedContents,{})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"btn btn-error",type:"button",onClick:e.onCancel,children:e.canncelLabel||"キャンセル"}),(0,a.jsx)("button",{className:"btn btn-success",children:e.commmitLabel||"完了"})]})]})})})}let V=()=>{let[e,l]=(0,t.useState)("close");return(0,a.jsxs)(a.Fragment,{children:["open"===e?(0,a.jsxs)("dialog",{className:"modal modal-open",children:[(0,a.jsxs)("div",{className:" modal-box",children:[(0,a.jsx)(M.Apply,{}),(0,a.jsx)(M.Copy,{}),(0,a.jsx)(M.Edit,{}),(0,a.jsx)(M.Delete,{})]}),(0,a.jsx)("label",{className:"modal-backdrop",onClick:()=>l("close")})]}):null,(0,a.jsxs)("li",{className:"flex gap-2 items-center cursor-pointer px-5 py-4 hover:bg-base-200 rounded-box",onClick:()=>l("open"),children:[(0,a.jsx)("div",{children:(0,a.jsx)(P.Image,{width:60,className:" rounded-box aspect-square object-cover"})}),(0,a.jsxs)("div",{className:"flex flex-col grow",children:[(0,a.jsx)(P.Name,{className:"text-md font-extralight"}),(0,a.jsx)(M.Title,{className:"text-lg"})]}),(0,a.jsx)("div",{children:(0,a.jsx)(M.TagBadge,{})})]})]})},K=()=>{let e=M.uses.useCreate({isNew:!0});return(0,a.jsx)("div",{className:"inline-flex items-center gap-3",children:(0,a.jsx)("button",{className:"btn btn-outline btn-success btn-xs",onClick:e,children:"新規追加"})})},Q=()=>{let[e,l]=(0,o.Gl)(""),s=(0,x.l)([]),t=(0,u.t)(e);return(0,a.jsxs)("div",{className:(0,r.Z)("flex items-center dropdown dropdown-bottom dropdown-hover w-full",{"[&>input]:hover:rounded-b-none":!(null==t||0==t.length)}),children:[(0,a.jsx)("input",{className:(0,r.Z)("input input-bordered input-sm input-ghost grow bg-base-100 text-base-content rounded-lg",{"focus:rounded-b-none":!(null==t||0==t.length)}),value:e,onChange:l,placeholder:"検索"}),(0,a.jsx)("div",{className:(0,r.Z)("dropdown-content z-10 bg-base-100 shadow-2xl w-full h-max max-h-96 perfect-scrollbar border-x rounded-b-lg",{"border-b":!(null==t||0==t.length)}),ref:s.ref,children:null==t||0==t.length?null:(0,a.jsx)("ul",{className:"flex flex-wrap gap-2 flex-col p-2",children:t.map(e=>(0,a.jsx)(M.Provider,{data:e,children:(0,a.jsx)(P.Provider,{id:e.gameId,children:(0,a.jsx)(V,{})})},e.id))})})]})}},12853:function(e,l,s){s.d(l,{RY:function(){return i},kQ:function(){return r},uB:function(){return c}});var a=s(57437);s(2265);var t=s(44839),n=s(23332);let r=(e,l,s)=>t=>{let n=e();if(null==n)return(0,a.jsx)("span",{...s,...t});let r=l.map(e=>n[e]).find(e=>null!=e);switch(typeof r){case"bigint":case"boolean":case"number":case"string":return(0,a.jsx)("span",{...s,...t,children:r.toString()});default:throw Error("")}},i=(e,l,s)=>t=>{let r=e();if(null==r)return(0,a.jsx)("time",{...s,...t});let i=l.map(e=>r[e]).find(e=>null!=e);switch(typeof i){case"number":case"string":case"object":if(!(i instanceof Date)&&!n.B.isDayjs(i))return;return(0,a.jsx)("time",{...s,...t,children:(0,n.B)(i).format(t.format||"YYYY/MM/DD hh:mm:ss")});default:throw Error("")}},c=(e,l,s,n)=>r=>{let i=e();if(null==i)return(0,a.jsx)("img",{...n,...r,className:(0,t.Z)(null==n?void 0:n.className,r.className),src:s.src,alt:s.alt});let c=l.src.map(e=>i[e]).find(e=>null!=e),d=l.alt.map(e=>i[e]).find(e=>null!=e);return"string"==typeof c&&"string"==typeof d?(0,a.jsx)("img",{...n,...r,className:(0,t.Z)(null==n?void 0:n.className,r.className),src:c,alt:d}):(0,a.jsx)("img",{...n,...r,className:(0,t.Z)(null==n?void 0:n.className,r.className),src:s.src,alt:s.alt})}},41789:function(e,l,s){s.d(l,{GameContextProvider:function(){return r},j:function(){return n}});var a=s(59151);let t=(0,s(39813).a)({fetcher:a.m7,idKey:"id"}),n=t.useContext,r=t.Provider}}]);