"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{7341:function(e,t,a){a.d(t,{e:function(){return i}});var n=a(3827),r=a(5793),s=a(7861),l=a(1863);let i=e=>(0,n.jsx)(n.Fragment,{children:e.fragments.map((e,t)=>{switch(e.type){case"emote":return(0,n.jsx)("img",{src:(0,l.jp)(e.emote.id),alt:e.text,className:"inline mx-1"},t);case"text":return(0,n.jsx)("span",{className:"break-all",dangerouslySetInnerHTML:{__html:(0,s.G9)(r.Y(e.text))}},t);case"mention":return(0,n.jsx)("a",{className:"link link-info",target:"__blank",href:(0,l.yd)(e.mention.user_login).CHANNEL,children:e.text},t)}})})},8716:function(e,t,a){a.d(t,{d:function(){return s}});var n=a(3827),r=a(3167);let s=e=>(0,n.jsx)("span",{className:(0,r.Z)("badge",e.type,e.outline?"badge-outline":"",e.size),children:e.children})},8246:function(e,t,a){a.r(t),a.d(t,{ModalProvider:function(){return _},useModalContext:function(){return N},useShowUserInfoModal:function(){return E}});var n=a(3827),r=a(4090),s=a(3167),l=a(8151),i=a(5762),c=a(66),d=a(3121),o=a(8716),u=a(8903),h=a(8473),m=a(7341),f=a(5835),p=a(4687);let w=e=>{let t=(0,p.Te)(e.userId||null),a=(0,f.l)([t]);return(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsx)("div",{ref:a.ref,className:"perfect-scrollbar",children:(0,n.jsxs)("ul",{className:"flex flex-col",children:[0===t.length?(0,n.jsx)("p",{children:"まだコメントが収集できてないです。"}):null,t.map(e=>{if("chat"!==e.messageType)return;let t=null!=e.fragments&&0!==e.fragments.length?(0,n.jsx)(m.e,{fragments:e.fragments}):e.message;return(0,n.jsxs)("li",{className:"break-words flex items-center px-2 justify-stretch border-b  border-base-300",children:[(0,n.jsx)("time",{className:"opacity-70 text-xs pr-1 whitespace-nowrap",children:(0,d.B)(e.timestamp).format("YYYY/MM/DD hh:mm:ss")}),(0,n.jsx)("p",{className:"px-2 py-1 border-l border-base-300",children:t})]},e.id)}).filter(h.h.notNull)]})}),(0,n.jsxs)("div",{className:"px-2 py-1 border-t-2 text-right",children:["総コメント数:",t.length]})]})};var v=a(1863),g=a(3382);let x=e=>(0,n.jsx)("span",{className:(0,s.Z)({"opacity-30":e.disabled}),children:(0,n.jsx)(o.d,{type:e.type,size:"badge-sm",children:e.name})}),y=e=>{let t=(0,i.useEventSubContext)(),a=(0,c.useUserGetById)(e.userId,{immediately:!0}),s=(0,r.useMemo)(()=>{var a;if((null==t?void 0:t.followers)==null)return null;let n=(null==t?void 0:null===(a=t.followers.find(t=>t.userId===e.userId))||void 0===a?void 0:a.followedAt)||null;return null==n?null:(0,d.B)(n)},[t,e.userId]),[o,h]=(0,r.useState)("");(0,r.useEffect)(()=>{l.db.users.where("id").equals(e.userId).first().then(e=>{null!=e&&h(e.metaComment||"")})},[e.userId]);let m=(0,r.useMemo)(()=>(0,n.jsxs)("ul",{className:"flex gap-2",children:[(0,n.jsx)("li",{children:(0,n.jsx)(x,{name:"スパム",type:"badge-error",disabled:!(null==a?void 0:a.isSpam)})}),(0,n.jsx)("li",{children:(0,n.jsx)(x,{name:"フォロワー",type:"badge-info",disabled:null==s})})]}),[s,t,a]),f=(0,g.Gq)(async()=>{if(null!=a)return(0,v.ZY)({broadcaster_id:a.id}).then(e=>e.total)},[a]);return null==a?(0,n.jsxs)("div",{className:"flex flex-col gap-4 w-52",children:[(0,n.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,n.jsx)("div",{className:"skeleton w-40 h-40 rounded-full shrink-0"}),(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)("div",{className:"skeleton h-4 w-20"}),(0,n.jsx)("div",{className:"skeleton h-4 w-28"})]})]}),(0,n.jsx)("div",{className:"skeleton h-32 w-full"})]}):(0,n.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,n.jsxs)("div",{className:"flex gap-6 content-stretch bg-cover",children:[(0,n.jsx)("div",{className:"chat-image avatar dropdown dropdown-end",children:(0,n.jsx)("div",{className:"w-40 rounded-full border",tabIndex:0,role:"button",children:(0,n.jsx)("img",{alt:a.displayName,src:a.profileImageUrl})})}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsxs)("p",{children:["名前: ",a.displayName||a.login]}),(0,n.jsxs)("p",{children:["ID: ",a.id]}),(0,n.jsxs)("p",{children:["フォロワー数: ",f]}),s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:["フォロー開始日: ",s.format("YYYY/MM/DD")]}),(0,n.jsxs)("p",{children:["フォロー開始日: ",s.from((0,d.B)())]})]}),(0,n.jsx)("div",{className:"mt-auto",children:m})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{children:(0,n.jsxs)("a",{className:"link link-info flex gap-1 py-2 items-center",target:"__blank",href:"https://www.twitch.tv/".concat(a.login),children:["Twitch ",u.U.EXTERNAL]})})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("p",{className:"font-black",children:"BIO"}),(0,n.jsx)("textarea",{className:"textarea textarea-bordered leading-4",placeholder:"Bio",rows:6,cols:50,value:o,onChange:t=>{h(t.currentTarget.value),l.db.users.update(e.userId,{metaComment:t.currentTarget.value})}})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("p",{className:"font-black",children:"コメント一覧"}),(0,n.jsx)("div",{className:"h-56 border rounded-md",children:(0,n.jsx)(w,{userId:a.id})})]})]})},b=(0,r.createContext)({open:()=>{},close:()=>{}}),N=()=>(0,r.useContext)(b),E=()=>{let e=N();return{open:(0,r.useCallback)(t=>{e.open((0,n.jsx)(y,{userId:t}))},[e])}},_=e=>{let[t,a]=(0,r.useState)(null),s=(0,r.useRef)(null),l=(0,f.l)([],{suppressScrollX:!0}),i=(0,r.useCallback)(e=>{var t,n;a(e),null===(t=s.current)||void 0===t||t.showModal(),null===(n=l.refScroll.current)||void 0===n||n.update()},[]),c=(0,r.useCallback)(()=>{var e;null===(e=s.current)||void 0===e||e.close()},[]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b.Provider,{value:{open:i,close:c},children:e.children}),(0,n.jsxs)("dialog",{ref:s,className:"modal",children:[(0,n.jsx)("div",{className:"modal-box perfect-scrollbar-nopadding h-min",ref:l.ref,children:t}),(0,n.jsx)("form",{method:"dialog",className:"modal-backdrop",children:(0,n.jsx)("button",{children:"close"})})]})]})}},314:function(e,t,a){a.d(t,{Q:function(){return h},F:function(){return u}});var n=a(3827),r=a(4090),s=a(3167),l=JSON.parse('["light","dark","cupcake","bumblebee","emerald","corporate","synthwave","retro","cyberpunk","valentine","halloween","garden","forest","aqua","lofi","pastel","fantasy","wireframe","black","luxury","dracula","cmyk","autumn","business","acid","lemonade","night","coffee","winter","dim","nord","sunset",{"mytheme":{"primary":"#ff0086","secondary":"#a0a000","accent":"#ff3f00","neutral":"#131f25","base-100":"#372a2d","info":"#00b5f1","success":"#00e848","warning":"#c35400","error":"#e2000a","--rounded-box":"1rem","--rounded-btn":"0.5rem","--rounded-badge":"1.9rem","--animation-btn":"0.25s","--animation-input":"0.2s","--btn-focus-scale":"0.95","--border-btn":"1px","--tab-border":"1px","--tab-radius":"0.5rem"}}]'),i=a(2338),c=a(5835);let d="theme-application-001",o=()=>localStorage.getItem(d)||"lemonade",u=()=>{(0,r.useEffect)(()=>{(0,i.E_)().dataset.theme=o()},[])},h=()=>{let e=(0,r.useMemo)(()=>l.map(e=>"string"==typeof e?e:Object.keys(e)).flat(),[l]),[t,a]=(0,r.useState)(),u=(0,r.useCallback)(e=>{localStorage.setItem(d,e),a(e)},[]),h=(0,r.useCallback)(e=>{u(e.currentTarget.value)},[]);(0,r.useEffect)(()=>{a(o())},[]),(0,r.useEffect)(()=>{null!=t&&((0,i.E_)().dataset.theme=t)},[t]);let m=(0,c.l)([],{suppressScrollX:!0}),f=e=>(0,n.jsx)("div",{className:"w-2 rounded-badge h-6 flex items-center justify-center ".concat(e.type)});return(0,n.jsxs)("div",{className:"dropdown dropdown-bottom",children:[(0,n.jsx)("button",{tabIndex:0,className:"btn btn-secondary w-48 btn-sm",children:t}),(0,n.jsx)("div",{tabIndex:0,className:" dropdown-content border z-[1] menu shadow bg-base-100 rounded-box w-64 h-96 ",children:(0,n.jsx)("div",{ref:m.ref,className:(0,s.Z)("w-full perfect-scrollbar"),children:(0,n.jsx)("ul",{className:" flex flex-col gap-2 ",children:e.map(e=>(0,n.jsx)("li",{children:(0,n.jsx)("button",{className:"btn w-full border",onClick:h,"data-theme":e,value:e,disabled:t===e,children:(0,n.jsxs)("div",{className:" flex gap-1 items-center w-full ",children:[(0,n.jsx)("div",{className:"text-left text-xs grow w-full",children:e}),(0,n.jsxs)("div",{className:"flex gap-1 ml-auto",children:[(0,n.jsx)(f,{type:"bg-primary text-primary-content"}),(0,n.jsx)(f,{type:"bg-secondary text-secondary-content"}),(0,n.jsx)(f,{type:"bg-accent text-accent-content"}),(0,n.jsx)(f,{type:"bg-neutral text-neutral-content"}),(0,n.jsx)(f,{type:"bg-base-100 text-base-content"}),(0,n.jsx)(f,{type:"bg-info"}),(0,n.jsx)(f,{type:"bg-success"}),(0,n.jsx)(f,{type:"bg-warning"}),(0,n.jsx)(f,{type:"bg-error"})]})]})})},e))})})})]})}},8903:function(e,t,a){a.d(t,{U:function(){return r}});var n=a(3827);let r={DATABASE:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M12 20c-2.337 0-4.255-.298-5.753-.893C4.749 18.512 4 17.745 4 16.807V7c0-.83.78-1.538 2.34-2.123C7.9 4.292 9.787 4 12 4s4.1.292 5.66.877C19.22 5.462 20 6.169 20 7v9.808c0 .937-.749 1.703-2.247 2.299-1.498.596-3.416.894-5.753.893zm0-11.11a16.3 16.3 0 004.33-.599c1.456-.4 2.327-.834 2.612-1.305-.273-.496-1.13-.951-2.57-1.365A15.749 15.749 0 0012 5c-1.453 0-2.908.2-4.366.599-1.458.4-2.33.836-2.615 1.31.272.5 1.13.955 2.576 1.366A16.04 16.04 0 0012 8.89zm0 5.033c.687 0 1.362-.033 2.025-.1a16.917 16.917 0 001.901-.297 11.973 11.973 0 001.685-.491c.52-.196.982-.418 1.389-.665V8.275a8.42 8.42 0 01-1.39.664 11.8 11.8 0 01-1.684.49c-.605.132-1.238.231-1.901.298a20.22 20.22 0 01-4.104-.01 18.148 18.148 0 01-1.906-.306 12.2 12.2 0 01-1.663-.482A7.417 7.417 0 015 8.275v4.096c.391.247.842.465 1.352.654.51.19 1.064.35 1.663.482.597.131 1.233.234 1.906.307.673.073 1.366.11 2.079.109zM12 19c.857 0 1.671-.049 2.443-.146a13.611 13.611 0 002.082-.414c.616-.179 1.14-.392 1.57-.641.43-.249.732-.517.905-.805v-3.623c-.407.247-.87.468-1.39.664-.518.196-1.08.36-1.684.491-.605.131-1.238.23-1.901.297a20.211 20.211 0 01-4.104-.01 18.132 18.132 0 01-1.906-.306 12.2 12.2 0 01-1.663-.482A7.242 7.242 0 015 13.371V17c.173.301.474.572.903.812.429.24.95.449 1.566.627.615.178 1.31.316 2.085.415.775.099 1.59.147 2.446.146z"})}),CROSS:{MD:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",className:"stroke-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",d:"M6 6l12 12m0-12L6 18"})}),SIZE:e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",style:{width:e.size},className:"stroke-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",d:"M6 6l12 12m0-12L6 18"})})},SEARCH:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M19.485 20.154l-6.262-6.262c-.5.426-1.075.756-1.725.989-.65.233-1.303.35-1.96.35-1.601 0-2.957-.554-4.066-1.663-1.11-1.109-1.664-2.464-1.664-4.065 0-1.601.554-2.957 1.662-4.067 1.108-1.11 2.463-1.666 4.064-1.667 1.601-.001 2.957.553 4.068 1.664 1.11 1.11 1.666 2.466 1.666 4.067 0 .695-.123 1.367-.369 2.017a5.474 5.474 0 01-.97 1.668l6.262 6.261-.706.708zM9.539 14.23c1.327 0 2.447-.457 3.36-1.37.913-.913 1.37-2.034 1.37-3.361 0-1.327-.457-2.447-1.37-3.36-.913-.913-2.033-1.37-3.36-1.37s-2.447.456-3.361 1.37c-.914.914-1.37 2.034-1.37 3.36s.457 2.446 1.37 3.36c.913.914 2.033 1.37 3.36 1.37"})}),EXTERNAL:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"21",height:"21",fill:"none",className:"stroke-current",viewBox:"0 0 21 21",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.5 8.5v-5m0 0h-5m5 0l-7 7m-1-7h-5a2 2 0 00-2 2v10a2 2 0 002 2h11a2 2 0 002-2v-4"})}),TODO:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"stroke-current fill-current",viewBox:"0 0 24 24",children:[(0,n.jsx)("g",{clipPath:"url(#clip0_193_39)",children:(0,n.jsx)("path",{d:"M7.27 0a.923.923 0 00-.606.346L3.519 4.298 1.442 2.913A.936.936 0 10.404 4.471l2.77 1.847a.923.923 0 001.24-.203L8.106 1.5A.923.923 0 007.27 0zm3.807 2.77v1.845H24V2.77H11.077zM7.269 8.307a.923.923 0 00-.605.346l-3.145 3.951-2.077-1.384a.936.936 0 00-1.039 1.558l2.77 1.846a.923.923 0 001.24-.202l3.693-4.615a.923.923 0 00-.837-1.5zm3.808 2.769v1.846H24v-1.846H11.077zm-3.808 5.538a.923.923 0 00-.605.347l-3.145 3.951-2.077-1.384a.935.935 0 10-1.039 1.558l2.77 1.846a.923.923 0 001.24-.202l3.693-4.616a.923.923 0 00-.837-1.5zm3.808 2.77v1.846H24v-1.846H11.077z"})}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_193_39",children:(0,n.jsx)("path",{d:"M0 0H24V24H0z"})})})]}),REWARD:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"stroke-current fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M14.3 21.7c-.7.2-1.5.3-2.3.3-5.5 0-10-4.5-10-10S6.5 2 12 2c1.3 0 2.6.3 3.8.7l-1.6 1.6c-.7-.2-1.4-.3-2.2-.3-4.4 0-8 3.6-8 8s3.6 8 8 8c.4 0 .9 0 1.3-.1.2.7.6 1.3 1 1.8zM7.9 10.1l-1.4 1.4L11 16 21 6l-1.4-1.4-8.6 8.6-3.1-3.1zM18 14v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2z"})}),EYE:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",className:"stroke-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M3 13c3.6-8 14.4-8 18 0M12 17a3 3 0 110-6 3 3 0 010 6z"})}),GEAR:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M17.3 10.453l1.927.315a.327.327 0 01.273.322v1.793a.326.326 0 01-.27.321l-1.93.339c-.111.387-.265.76-.459 1.111l1.141 1.584a.326.326 0 01-.034.422l-1.268 1.268a.326.326 0 01-.418.037l-1.6-1.123c-.354.197-.73.354-1.118.468l-.34 1.921a.326.326 0 01-.322.269H11.09a.325.325 0 01-.321-.272l-.319-1.911a5.498 5.498 0 01-1.123-.465l-1.588 1.113a.326.326 0 01-.418-.037L6.052 16.66a.327.327 0 01-.035-.42l1.123-1.57a5.499 5.499 0 01-.47-1.129l-1.901-.337a.326.326 0 01-.269-.321V11.09c0-.16.115-.296.273-.322l1.901-.317c.115-.393.272-.77.47-1.128l-1.11-1.586a.326.326 0 01.037-.417L7.34 6.053a.326.326 0 01.42-.035l1.575 1.125a5.46 5.46 0 011.121-.46l.312-1.91a.327.327 0 01.322-.273h1.793c.159 0 .294.114.322.27l.336 1.92c.389.112.764.268 1.12.465l1.578-1.135a.326.326 0 01.422.033l1.268 1.268a.326.326 0 01.036.418L16.84 9.342c.193.352.348.724.46 1.11v.001zM9.716 12a2.283 2.283 0 104.566 0 2.283 2.283 0 00-4.566 0z"})}),GAME:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("g",{clipPath:"url(#clip0_167_45)",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M17 4c.763 0 1.394.434 1.856.89.481.473.922 1.109 1.314 1.81.787 1.406 1.472 3.243 1.925 5.058.45 1.801.699 3.682.54 5.161C22.475 18.404 21.71 20 20 20c-1.476 0-2.652-.76-3.614-1.531l-.351-.289-.492-.415-.444-.368C14.08 16.572 13.175 16 12 16c-1.175 0-2.08.572-3.099 1.397l-.444.368-.492.415-.35.289C6.651 19.24 5.475 20 4 20c-1.711 0-2.476-1.596-2.635-3.081-.158-1.48.09-3.36.54-5.161.453-1.815 1.138-3.652 1.925-5.059.392-.7.833-1.336 1.314-1.81C5.606 4.434 6.237 4 7 4c.515 0 1.018.123 1.513.27l.592.181c.099.03.197.06.295.087.865.248 1.75.462 2.6.462.85 0 1.735-.214 2.6-.462l.885-.267C15.983 4.124 16.49 4 17 4zm0 2c-.383 0-.783.116-1.171.243l-.458.151a7.269 7.269 0 01-.221.068c-.885.252-2 .538-3.15.538s-2.265-.286-3.15-.538l-.22-.068-.459-.151C7.783 6.115 7.383 6 7 6c-.418.078-.793.585-1.076 1.055l-.158.275-.19.346c-.682 1.218-1.31 2.88-1.73 4.567-.395 1.576-.587 3.086-.514 4.21l.026.293.02.176.03.208c.069.401.218.87.592.87.812 0 1.49-.404 2.333-1.074l.403-.328.76-.636.344-.28C8.904 14.839 10.235 14 12 14c1.765 0 3.096.84 4.16 1.682l.345.28.76.636.402.328C18.51 17.596 19.187 18 20 18c.34 0 .494-.387.571-.759l.038-.218.037-.317c.123-1.146-.067-2.765-.491-4.463-.386-1.546-.946-3.072-1.562-4.254l-.359-.66-.158-.273C17.793 6.585 17.418 6.078 17 6zM8.5 8a2.5 2.5 0 110 5 2.5 2.5 0 010-5zm7 0a1 1 0 01.993.883L16.5 9v.5h.5a1 1 0 01.117 1.993L17 11.5h-.5v.5a1 1 0 01-1.993.117L14.5 12v-.5H14a1 1 0 01-.117-1.993L14 9.5h.5V9a1 1 0 011-1zm-7 2a.5.5 0 100 1 .5.5 0 000-1z",clipRule:"evenodd"})})}),BROADCAST:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M4.929 2.929l1.414 1.414A7.975 7.975 0 004 10c0 2.21.895 4.21 2.343 5.657L4.93 17.07A9.968 9.968 0 012 10a9.969 9.969 0 012.929-7.071zm14.142 0A9.967 9.967 0 0122 10a9.971 9.971 0 01-2.929 7.071l-1.414-1.414A7.972 7.972 0 0020 10c0-2.21-.895-4.21-2.343-5.657l1.414-1.414zM7.757 5.757l1.415 1.415A3.987 3.987 0 008 10c0 1.105.448 2.105 1.172 2.829l-1.415 1.414A5.982 5.982 0 016 10c0-1.657.672-3.157 1.757-4.243zm8.486 0A5.982 5.982 0 0118 10a5.983 5.983 0 01-1.757 4.243l-1.415-1.415A3.988 3.988 0 0016 10a3.986 3.986 0 00-1.172-2.828l1.415-1.415zM12 12a2 2 0 110-4 2 2 0 010 4zm-1 2h2v8h-2v-8z"})}),NOTIFICATION:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M12 2a7 7 0 00-7 7v3.528a1 1 0 01-.105.447l-1.717 3.433A1.1 1.1 0 004.162 18h15.676a1.1 1.1 0 00.984-1.592l-1.716-3.433a1 1 0 01-.106-.447V9a7 7 0 00-7-7zm0 19a3.002 3.002 0 01-2.83-2h5.66A3 3 0 0112 21z"})}),TWITTER:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",className:"fill-current",children:(0,n.jsx)("path",{d:"M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"})}),YOUTUBE:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",className:"fill-current",children:(0,n.jsx)("path",{d:"M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"})}),FACEBOOK:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",className:"fill-current",children:(0,n.jsx)("path",{d:"M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"})}),INFORMATION:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-info shrink-0 w-6 h-6",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),FOLLOW:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:[(0,n.jsx)("g",{clipPath:"url(#clip0_158_48)",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M16 14a5 5 0 015 5v2a1 1 0 01-2 0v-2a3 3 0 00-3-3H8a3 3 0 00-3 3v2a1 1 0 11-2 0v-2a5 5 0 015-5h8zm5.414-4.919a1 1 0 011.498 1.32l-.084.095L20 13.324a1 1 0 01-1.32.083l-.094-.083-1.414-1.414a1 1 0 011.32-1.498l.094.083.707.708 2.121-2.122zM12 2a5 5 0 110 10 5 5 0 010-10zm0 2a3 3 0 100 6 3 3 0 000-6z",clipRule:"evenodd"})}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_158_48",children:(0,n.jsx)("path",{fill:"#fff",d:"M0 0H24V24H0z"})})})]}),COMMENT:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"fill-current",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{d:"M6.5 13.5h7v-1h-7v1zm0-3h11v-1h-11v1zm0-3h11v-1h-11v1zM3 20.077V4.615c0-.46.154-.844.463-1.152A1.562 1.562 0 014.615 3h14.77c.46 0 .844.154 1.152.463.309.308.463.692.463 1.152v10.77c0 .46-.154.844-.462 1.153a1.567 1.567 0 01-1.153.462H6.077L3 20.077zM5.65 16h13.735a.59.59 0 00.423-.192.59.59 0 00.192-.423V4.615a.59.59 0 00-.192-.423.59.59 0 00-.423-.192H4.615a.59.59 0 00-.423.192.59.59 0 00-.192.423v13.03L5.65 16z"})})}},9826:function(e,t,a){a.d(t,{b:function(){return c}});var n=a(4090),r=a(7952),s=a(1231),l=a(2338);let i=e=>function(){for(var t=arguments.length,a=Array(t),n=0;n<t;n++)a[n]=arguments[n];"production"!==e&&console.log(...a)},c=e=>{let{fetcher:t,idKey:a,timeout:c,interval:d}=e,o=i("debug"),u=d||100,h=c||900,[m,f]=(0,r.Z)({initial:"initialized",states:{initialized:{on:{REQUEST_CREATE:"createdRequest"}},createdRequest:{on:{FETCH:"fetching"},effect:()=>{setTimeout(()=>{f("FETCH")},u)}},fetching:{on:{COMPLETE:"completed",FAILE:"failed"},effect:()=>{y().then(()=>{f("COMPLETE")}).catch(()=>{f("FAILE")})}},completed:{on:{INITIALIZE:"initialized",REST_REQUEST:"createdRequest"},effect:()=>{setTimeout(()=>{if(x(),0===p.current.size){f("INITIALIZE");return}f("REST_REQUEST")},u)}},failed:{on:{INITIALIZE:"initialized"},effect:()=>{console.error("fail to fetch")}}}}),p=(0,n.useRef)(new Set),w=(0,n.useRef)(new Map),v=(0,n.useRef)(new Set);(0,n.useEffect)(()=>{o(m.value,{queue:v.current,queues:p.current,data:w.current})},[m]);let g=(0,n.useCallback)(()=>0==p.current.size&&0===w.current.size,[]),x=(0,n.useCallback)(()=>{g()||(p.current=new Set,w.current=new Map)},[]),y=(0,n.useCallback)(async()=>{(await t(Array.from(p.current))).forEach(e=>w.current.set(e[a],e))},[]);return{fetchByIds:(0,n.useCallback)(async e=>{f("REQUEST_CREATE");let n=(0,s.Z)();return v.current.add(n),e.forEach(e=>p.current.add(e)),new Promise((r,s)=>{let i=()=>{if(e.filter(e=>w.current.has(e)).length===e.length)return w.current},c=(0,l.VX)(()=>{null!=i()&&(o(),r(w.current))},u/4),d=setTimeout(()=>{o(),t(e).then(e=>{e.forEach(e=>w.current.set(e[a],e)),r(w.current)}).catch(e=>{s(e)})},h);function o(){v.current.delete(n),c(),clearTimeout(d)}})},[]),immediately:t}}},5762:function(e,t,a){a.r(t),a.d(t,{EventSubContext:function(){return v},useEventSubContext:function(){return w}});var n=a(3827),r=a(4090),s=a(8151),l=a(670),i=a(5891);let c=e=>{let t={method:"websocket",session_id:e};return{stream:{online:e=>({type:"stream.online",version:"1",condition:{broadcaster_user_id:e},transport:t}),ofline:e=>({type:"stream.offline",version:"1",condition:{broadcaster_user_id:e},transport:t})},channel:{update:e=>({type:"channel.update",version:"2",condition:{broadcaster_user_id:e},transport:t}),chat:{message:(e,a)=>({type:"channel.chat.message",version:"1",condition:{broadcaster_user_id:e,user_id:a},transport:t}),notification:(e,a)=>({type:"channel.chat.notification",version:"1",condition:{broadcaster_user_id:e,user_id:a},transport:t})},channel_points_automatic_reward:{add:e=>({type:"channel.channel_points_automatic_reward_redemption.add",version:"1",condition:{broadcaster_user_id:e},transport:t})},channel_points_custom_reward:{add:e=>({type:"channel.channel_points_custom_reward.add",version:"1",condition:{broadcaster_user_id:e},transport:t})},points_custom_reward_redemption:{add:(e,a)=>({type:"channel.channel_points_custom_reward_redemption.add",version:"1",condition:{broadcaster_user_id:e,rewardId:a},transport:t})},channel_points_automatic_reward_redemption:{add:e=>({type:"channel.channel_points_automatic_reward_redemption.add",version:"1",condition:{broadcaster_user_id:e},transport:t})}}}};var d=a(1863);let o=e=>(e<=0&&console.warn("keepalive timeout secondsは0以上の値である必要があります。"),e>=600&&console.warn("keepalive timeout secondsは600以下の値である必要があります。"),"".concat("wss://eventsub.wss.twitch.tv/ws","?keepalive_timeout_seconds=").concat(e)),u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=new WebSocket(o(t));new Promise(e=>{let t=()=>{a.removeEventListener("open",t),e({})};a.addEventListener("open",t)});let n=(e,t)=>{let n=a=>{let n=JSON.parse(a.data);e===n.metadata.message_type&&t(n,a)};return a.addEventListener("message",n),n},r=e=>{a.removeEventListener("message",e)},s=async()=>{let t=c(await new Promise(e=>{let t=n("session_welcome",function(a){r(t),e(a.payload.session.id)})}));await Promise.all([(0,d.ad)(t.channel.chat.message(e,e)),(0,d.ad)(t.channel.update(e)),(0,d.ad)(t.stream.online(e)),(0,d.ad)(t.stream.ofline(e)),(0,d.ad)(t.channel.channel_points_automatic_reward_redemption.add(e)),(0,d.ad)(t.channel.channel_points_custom_reward.add(e)),(0,d.ad)(t.channel.points_custom_reward_redemption.add(e))])};return i.kh.DEBUG&&(a.addEventListener("message",e=>{console.log("socket message",JSON.parse(e.data))}),a.addEventListener("error",e=>{console.log("socket error",e)}),a.addEventListener("close",e=>{console.log("socket closed",e)})),{socket:a,close:()=>{a.close()},start:s,notification:{addListener:(e,t)=>{let n=a=>{let n=JSON.parse(a.data);"notification"===n.metadata.message_type&&n.metadata.subscription_type===e&&t(n,a)};return a.addEventListener("message",n),n},removeListener:r},addListener:n,removeListener:r}};var h=a(3382),m=a(314),f=a(863);let p=r.createContext(null),w=()=>r.useContext(p),v=e=>{(0,m.F)(),r.useEffect(()=>{d.MH({onSuccess:()=>{location.href="/twitch-comment-viewer-v1-frontend"}})},[]);let t=(0,h.f0)(),{Provider:a}=p,[i,c]=r.useState(null);r.useEffect(()=>{d.iP()||t(),d.IK().then(e=>{if(null==e.data[0])throw Error("データが見つかりませんでした");c({id:e.data[0].id,channelName:e.data[0].login})}).catch(()=>{t()})},[]);let o=r.useMemo(()=>{if(null==i)return;let e=u(i.id);return e.start(),e},[i]),w=(0,l.hO)(),v=(0,l.we)(null==i?void 0:i.id);r.useEffect(()=>{if(null==o||null==i)return;let e=i.id,t=o.notification.addListener("channel.update",t=>{s.db.channelHistories.put({channelId:e,type:"update",broadcastTitle:t.payload.event.title,categoryId:t.payload.event.category_id,categoryName:t.payload.event.category_name,language:t.payload.event.language,timestamp:new Date,rowdata:JSON.stringify(t),updateAt:new Date,createdAt:new Date}),w.update(e)}),a=o.notification.addListener("stream.online",()=>{w.update(e)}),n=o.notification.addListener("stream.offline",()=>{w.update(e)});return()=>{o.removeListener(t),o.removeListener(a),o.removeListener(n)}},[i]);let g=(0,l.Hf)(),x=(0,l.gS)();return((0,f.Y)(()=>{(null==i?void 0:i.id)!=null&&(x.update({userId:i.id,broadcasterId:i.id}),g.update(i.id),w.update(i.id))},{interval:1e4,deps:[i]}),r.useEffect(()=>()=>{null!=o&&o.close()},[o]),r.useEffect(()=>{if(null==o||null==i)return;let e=o.notification.addListener("channel.chat.message",e=>{s.db.actions.add({id:e.payload.event.message_id,userId:e.payload.event.chatter_user_id,channel:i.channelName,message:e.payload.event.message.text,messageType:"chat",fragments:e.payload.event.message.fragments,timestamp:Date.now(),rowdata:JSON.stringify(e),updateAt:new Date,createdAt:new Date})}),t=o.notification.addListener("channel.channel_points_automatic_reward_redemption.add",e=>{s.db.actions.add({id:e.payload.event.id,userId:e.payload.event.user_id,channel:i.channelName,userTitle:e.payload.event.reward.type,userInput:e.payload.event.user_input,rewardId:e.payload.event.reward.type,messageType:"atutomatic-reward",timestamp:Date.now(),rowdata:JSON.stringify(e),updateAt:new Date,createdAt:new Date})}),a=o.notification.addListener("channel.channel_points_custom_reward_redemption.add",e=>{s.db.actions.add({id:e.payload.event.id,userId:e.payload.event.user_id,channel:i.channelName,userTitle:e.payload.event.reward.title,userInput:e.payload.event.user_input,rewardId:e.payload.event.reward.id,messageType:"reward",timestamp:Date.now(),rowdata:JSON.stringify(e),updateAt:new Date,createdAt:new Date})});return()=>{o.notification.removeListener(e),o.notification.removeListener(a),o.notification.removeListener(t)}},[o,i]),d.AC()||!d.iP()||null==i||null==o||null==v)?(0,n.jsx)(n.Fragment,{children:e.children}):(0,n.jsx)(a,{value:{me:{id:i.id,channelName:i.channelName},live:w.data,chatUsers:x.data,socket:o,followers:v},children:e.children})}},66:function(e,t,a){a.r(t),a.d(t,{UserContextProvider:function(){return h},useGetUserMap:function(){return o},useUserContext:function(){return d},useUserGetById:function(){return u}});var n=a(3827),r=a(4090),s=a(6639),l=a(670),i=a(9826);let c=(0,r.createContext)({fetchUserById:()=>{throw Error("error")},fetchUserByIds:()=>{throw Error("error")},immediately:()=>{throw Error("error")}}),d=()=>(0,r.useContext)(c),o=e=>{let t=d();return(0,s.yR)(async()=>await t.fetchUserByIds(e),[e])},u=(e,t)=>{let a=(null==t?void 0:t.immediately)||!1,n=d();return(0,s.yR)(async()=>a?await n.immediately(e):await n.fetchUserById(e),[e])},h=e=>{let t=(0,i.b)({fetcher:l.Rf,idKey:"id"});return t.immediately,(0,n.jsx)(c.Provider,{value:{fetchUserByIds:async e=>await t.fetchByIds(e),fetchUserById:async e=>(await t.fetchByIds([e])).get(e)||null,immediately:async e=>(await t.immediately([e]))[0]||null},children:e.children})}},3121:function(e,t,a){a.d(t,{B:function(){return d}});var n=a(9539),r=a.n(n);a(8757);var s=a(3654),l=a.n(s),i=a(5058),c=a.n(i);r().extend(l()),r().extend(c()),r().locale("ja");let d=r()},7861:function(e,t,a){a.d(t,{G9:function(){return r},s7:function(){return n}});let n=/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/,r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{start:'<a class="link link-info" href="$&" target="__blank">',end:"</a>"};return e.replace(n,"".concat(t.start,"$&").concat(t.end))}},1863:function(e,t,a){a.d(t,{AC:function(){return w},Ag:function(){return l},Fv:function(){return b},HB:function(){return g},IK:function(){return I},MH:function(){return p},PK:function(){return i},Pr:function(){return _},Xh:function(){return y},ZY:function(){return E},ad:function(){return T},iP:function(){return v},j3:function(){return N},jp:function(){return o},sT:function(){return x},uh:function(){return j},yd:function(){return u}});var n=a(684),r=a(3666),s=a(5891);let l=[{name:"薬物・酩酊・過度の喫煙",id:"DrugsIntoxication",description:"タバコの過度な賛美・宣伝、マリファナの摂取・使用、合法薬物やアルコールによる酩酊、違法薬物の話題。"},{name:"性的なテーマ",id:"SexualThemes",description:"実際に金銭のやり取りが発生する、オンラインまたは対面式のギャンブル、ポーカー、ファンタジースポーツへの参加。"},{name:"著しい冒涜や下品な表現",id:"ProfanityVulgarity",description:"特に通常の会話内での、猥褻的・冒涜的・下品な表現の頻繁な使用。"},{name:"ギャンブル",id:"Gambling",description:"実際に金銭のやり取りが発生する、オンラインまたは対面式のギャンブル、ポーカー、ファンタジースポーツへの参加。"},{name:"暴力的で露骨な描写",id:"ViolentGraphic",description:"リアルな暴力、流血、重傷、死のシミュレーションや描写。"}],i=[{id:"ja",name:"日本語"},{id:"en",name:"English"},{id:"id",name:"Bahasa Indonesia"},{id:"ca",name:"Catal\xe0"},{id:"da",name:"Dansk"},{id:"de",name:"Deutsch"},{id:"es",name:"Espa\xf1ol"},{id:"fr",name:"Fran\xe7ais"},{id:"it",name:"Italiano"},{id:"hu",name:"Magyar"},{id:"nl",name:"Nederlands"},{id:"no",name:"Norsk"},{id:"pl",name:"Polski"},{id:"pt",name:"Portugu\xeas"},{id:"ro",name:"Rom\xe2nă"},{id:"sk",name:"Slovenčina"},{id:"fi",name:"Suomi"},{id:"sv",name:"Svenska"},{id:"tl",name:"Tagalog"},{id:"vi",name:"Tiếng Việt"},{id:"tr",name:"T\xfcrk\xe7e"},{id:"cs",name:"Čeština"},{id:"el",name:"Ελληνικά"},{id:"bg",name:"Български"},{id:"ru",name:"Русский"},{id:"uk",name:"ภาษาไทย"},{id:"zh",name:"中文"},{id:"zh-hk",name:"粵語"},{id:"ko",name:"한국어"},{id:"asl",name:"American Sign Language"},{id:"other",name:"その他"}],c={GAMES:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/games"},USER:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/users"},CHAT:{CHATTERS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/chat/chatters"}},CHANNELS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/channels",PATCH:{METHOD:"PATCH",ENDPOINT:"https://api.twitch.tv/helix/channels"},FOLLOWERS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/channels/followers"}},STREAMS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/streams"},SEARCH:{CHANNELS:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/search/channels"},CATEGORIES:{METHOD:"GET",ENDPOINT:"https://api.twitch.tv/helix/search/categories"}},EVENTSUB:{SUBSCRIPTIONS:{METHOD:"POST",ENDPOINT:"https://api.twitch.tv/helix/eventsub/subscriptions"}}},d=async(e,t)=>{let a=k(m()),n=async a=>{if(!a.ok){let n=await a.json();throw Error("fetch error\n    ".concat(JSON.stringify({status:a.status,endpoint:e.ENDPOINT,params:t,response:n})))}},s=async()=>"GET"===e.METHOD?await a("".concat(e.ENDPOINT,"?").concat(r.Z.stringify(t)),{method:e.METHOD}):await a(e.ENDPOINT,{method:e.METHOD,body:JSON.stringify(t)}),l=await s();return n(l),await l.json().catch(()=>{})},o=e=>"https://static-cdn.jtvnw.net/emoticons/v2/".concat(e,"/default/light/1.0"),u=e=>({STREAM_MANAGER:"https://dashboard.twitch.tv/u/".concat(e,"/stream-manager"),CHANNEL:"https://www.twitch.tv/".concat(e)}),h="twitch_token",m=()=>{let e=localStorage.getItem(h);if(null==e)throw Error("twitch token is not found");return e},f=()=>{if(s.sk)return null;let e=window.location.hash.match(/access_token=(.*)&scope/);return null==e?null:e[1]},p=e=>{if(s.sk)return null;let t=f();null!=t&&(localStorage.setItem(h,t),e.onSuccess())},w=()=>null!=f(),v=()=>!s.sk&&null!=window.localStorage.getItem(h),g=()=>localStorage.removeItem(h),x=async e=>{let t=await d(c.SEARCH.CATEGORIES,e);return new n.Z(t.data,{keys:["name"]}).search(e.query).map(e=>e.item)},y=async e=>{let{id:t,patch:a}=e;return await d({ENDPOINT:"".concat(c.CHANNELS.PATCH.ENDPOINT,"?broadcaster_id=").concat(t.broadcaster_id),METHOD:c.CHANNELS.PATCH.METHOD},a)},b=async e=>await d(c.STREAMS,e),N=async e=>await d(c.GAMES,e),E=async e=>await d(c.CHANNELS.FOLLOWERS,e),_=async e=>await d(c.CHAT.CHATTERS,e),j=async e=>await d(c.USER,e),I=async()=>await j({}),T=async e=>await d(c.EVENTSUB.SUBSCRIPTIONS,e),k=e=>{let t={Authorization:"Bearer ".concat(e),"Client-Id":"of40zatnkd1ftcaqnf92ahqznkg1vn","Content-Type":"application/json"};return function(){for(var e=arguments.length,a=Array(e),n=0;n<e;n++)a[n]=arguments[n];let[r,s,...l]=a;return fetch(r,{...s,headers:{...t,...(null==s?void 0:s.headers)||{}}},...l)}}},8473:function(e,t,a){a.d(t,{h:function(){return n}});let n={notNull:e=>null!=e,notDeleted:e=>null==e.deletedAt}},3382:function(e,t,a){a.d(t,{Gl:function(){return i},Gq:function(){return l},Nr:function(){return c},f0:function(){return d}});var n=a(4090),r=a(7907),s=a(2983);let l=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let[r,s]=t,[l,i]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let e=r();i(null),e.then(e=>{i(e)})},s),l},i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[t,a]=(0,n.useState)(e);return[t,(0,n.useCallback)(e=>{e.currentTarget instanceof HTMLInputElement&&a(e.currentTarget.value)},[])]},c=(e,t,a)=>(0,n.useMemo)(()=>(0,s.D)(e,t),a),d=()=>{let e=(0,r.useRouter)();return(0,n.useCallback)(()=>{e.push("/login")},[e])}},2338:function(e,t,a){a.d(t,{E_:function(){return n},VX:function(){return r}});let n=()=>document.getElementsByTagName("html")[0],r=(e,t)=>{let a=null,n=async()=>{await e(),a=window.setTimeout(n,t)};return a=window.setTimeout(n,t),()=>{null!=a&&window.clearTimeout(a)}}},5891:function(e,t,a){a.d(t,{kh:function(){return n},sd:function(){return s},sk:function(){return r}});let n={API_KEY:"of40zatnkd1ftcaqnf92ahqznkg1vn",OAUTH:{REDIRECT_URI:"https://gametark.github.io/twitch-comment-viewer-v1-frontend",TYPE:"token",SCOPE:"user:edit clips:edit user:read:chat channel:read:redemptions analytics:read:games moderator:read:chatters moderator:read:followers channel_editor"},DEBUG:!0},r=!1,s={ENTER:"Enter",BACKSPACE:"Backspace"}},8151:function(e,t,a){a.d(t,{X1:function(){return d},db:function(){return o}});var n=a(4090),r=a(8091),s=a(6639);let l={"2024/04/03.1":14,"2024/04/10":16,"2024/04/20":17,"2024/04/20.1":18,"2024/05/05":21,"2024/05/08":22,"2024/05/08.1":23,"2024/05/09":24};class i extends r.ZP{constructor(){super("twitch-comments"),this.version(l["2024/05/09"]).stores({users:"id,*userId,displayName,type,broadcasterType",actions:"++autoincrementId,id,*channel,messageType,*userId,*timestamp,[channel+timestamp]",followers:"++id,channelId,userId,[channelId+userId],createdAt,[channelId+createdAt]",channelHistories:"++id,channelId,type,categoryId,timestamp,[channelId+timestamp]",listenerHistories:"++id,channelId,userId,[channelId+timestamp]",games:"id,igdb_id,name",broadcastTemplates:"++id,channelId,gameId,*tags,favorite"})}}let c=async e=>{let t=await e.count();return async a=>({target:await e.offset(a.pageNo*a.pageSize).limit(a.pageSize).toArray(),page:a.pageNo+1,maxPage:Math.ceil(t/a.pageSize),hasPrev:a.pageNo>=1,hasNext:a.pageNo*a.pageSize<t-a.pageSize})},d=(e,t)=>{let[a,r]=(0,n.useState)(t.pageNo),l=(0,s.yR)(async()=>(r(0),c(e)),[e]);return{value:(0,s.yR)(()=>{if(null!=l)return l({pageNo:a,pageSize:t.pageSize})},[l,a,t.pageSize]),next:(0,n.useCallback)(()=>{r(e=>Math.max(e+1,0))},[]),prev:(0,n.useCallback)(()=>{r(e=>Math.max(e-1,0))},[])}},o=new i;(async()=>(console.log("migration"),o.version(l["2024/05/09"]).stores({users:"id,*userId,displayName,type,broadcasterType"}).upgrade(e=>e.table("users").toCollection().modify(e=>{delete e.view_count})),!0))().then(()=>{console.log("migrated")})},670:function(e,t,a){a.d(t,{Bo:function(){return k},Hf:function(){return v},Id:function(){return h},Rf:function(){return _},Xt:function(){return u},_o:function(){return b},bL:function(){return w},fk:function(){return N},gS:function(){return x},hO:function(){return y},m7:function(){return T},oV:function(){return o},uM:function(){return m},we:function(){return g}});var n=a(4090),r=a(6639),s=a(8151),l=a(3121),i=a(1863),c=a(8473),d=a(4687);let o=e=>{if(void 0===e)return s.db.broadcastTemplates.toArray();switch(e.type){case"id":return s.db.broadcastTemplates.bulkGet(e.value);case"gameId":return s.db.broadcastTemplates.where("gameId").equals(e.value).toArray();case"tags":return s.db.broadcastTemplates.where("tags").equals(e.value).toArray();case"favorite":return s.db.broadcastTemplates.toArray().then(t=>t.filter(t=>!!t.favorite==e.value))}},u=e=>s.db.broadcastTemplates.put({...e,updateAt:new Date,createdAt:new Date}),h=(e,t)=>s.db.broadcastTemplates.update(e,{...t}),m=e=>s.db.broadcastTemplates.bulkDelete(e),f=()=>[(0,l.B)(new Date).set("hours",0).set("minutes",0).set("seconds",0).toDate(),(0,l.B)(new Date).set("hours",24).set("minutes",0).set("seconds",0).toDate()],p=async e=>{let[t,a]=f();return(await s.db.followers.where("[channelId+createdAt]").between([e,t],[e,a]).sortBy("followedAt")).reverse().filter(c.h.notDeleted)},w=()=>(0,r.yR)(async()=>{let e=await s.db.users.toArray(),t=new Map;return e.forEach(e=>t.set(e.id,e)),t},[]),v=()=>({update:(0,n.useCallback)(async e=>{let t=await p(e),a=await (0,i.ZY)({broadcaster_id:e,first:"100"}).then(t=>t.data.map(t=>({channelId:e,userId:t.user_id,followedAt:new Date(t.followed_at),updateAt:new Date,createdAt:new Date}))),n=a.filter(e=>null==t.find(t=>t.userId===e.userId&&t.channelId===e.channelId)),r=t.filter(e=>null==a.find(t=>t.userId===e.userId&&t.channelId===e.channelId)).map(e=>({...e,deletedAt:new Date}));(0!==n.length||0!==r.length)&&await Promise.all([s.db.followers.bulkAdd(n),s.db.followers.bulkPut(r)])},[])}),g=e=>(0,r.yR)(async()=>{if(null!=e)return await p(e)},[e]),x=()=>{let[e,t]=(0,n.useState)([]),a=(0,n.useCallback)(async a=>{if(null==a.broadcasterId||null==a.userId)return;let n=await (0,i.Pr)({broadcaster_id:a.broadcasterId,moderator_id:a.userId}),r=await Promise.all(n.data.map(e=>j(e.user_id))).then(e=>e.filter(c.h.notNull));0!==r.filter(t=>!e.find(e=>e.id===t.id)).length&&t(r)},[e]);return{data:e,update:a}},y=()=>{let[e,t]=(0,n.useState)(null);return{data:e,update:(0,n.useCallback)(async e=>{let a=(await (0,i.Fv)({user_id:e})).data[0];if(null==a){t(null);return}t({isLive:!0,startedAt:new Date(a.started_at),viewerCount:a.viewer_count})},[])}},b=e=>(0,n.useCallback)(async t=>await s.db.users.update(e,t),[e]),N=()=>(0,d.hb)({limit:1/0}).length,E=async e=>{if(0===e.length)return[];let t=await (0,i.uh)({id:e}),a=await Promise.all(t.data.map(async e=>({id:e.id,login:e.login,displayName:e.display_name,type:e.type,broadcasterType:e.broadcaster_type,description:e.description,profileImageUrl:e.profile_image_url,offlineImageUrl:e.offline_image_url,createdAt:new Date,updateAt:new Date,rowData:JSON.stringify(e)})));return await s.db.users.bulkPut(a),(await s.db.users.bulkGet(e)).filter(c.h.notNull)},_=async e=>{if(e.length>100)throw Error("request id is 100未満 ".concat(e.length));let t=(await s.db.users.bulkGet(e)).filter(c.h.notNull),a=await E(e.filter(e=>-1===t.findIndex(t=>t.id===e)));return[...t,...a].filter(e=>!0!==e.isSpam)},j=async e=>(await _([e]))[0],I=async e=>{if(0===e.length)return[];let t=(await (0,i.j3)({id:e})).data.map(e=>({id:e.id,box_art_url:e.box_art_url,name:e.name,igdb_id:e.igdb_id,createdAt:new Date,updateAt:new Date}));return await s.db.games.bulkPut(t),(await s.db.games.bulkGet(e)).filter(c.h.notNull)},T=async e=>{if(e.length>100)throw Error("request id is 100未満 ".concat(e.length));let t=(await s.db.games.bulkGet(e)).filter(c.h.notNull),a=await I(e.filter(e=>-1===t.findIndex(t=>t.id===e)));return[...t,...a]},k=e=>(0,r.yR)(async()=>await j(e))},863:function(e,t,a){a.d(t,{Y:function(){return r}});var n=a(4090);let r=(e,t)=>{let{interval:a,deps:r,notFirst:s}=t;(0,n.useEffect)(()=>{s||setTimeout(e,0);let t=window.setInterval(e,a);return()=>{window.clearTimeout(t)}},[a,...r])}},5835:function(e,t,a){a.d(t,{l:function(){return s}});var n=a(4090),r=a(5312);let s=(e,t)=>{let a=(0,n.useRef)(null),s=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{if(null==a.current)return;let e=new r.Z(a.current,t);s.current=e,e.update(),setTimeout(()=>{e.update()},400);let n=new ResizeObserver(()=>{e.update()});return n.observe(a.current),()=>{null!=s.current&&(s.current.destroy(),s.current=null,n.disconnect())}},[]),(0,n.useLayoutEffect)(()=>{var e;null===(e=s.current)||void 0===e||e.update()},e),{ref:a,refScroll:s}}},4687:function(e,t,a){a.d(t,{Te:function(){return l},hb:function(){return i}});var n=a(6639),r=a(5762),s=a(8151);a(670);let l=(e,t)=>{let a=(null==t?void 0:t.limit)||1/0;return(0,n.yR)(async()=>{if(null!=e)return await s.db.actions.where("userId").equals(e).reverse().limit(a).sortBy("timestamp")},[e])||[]},i=e=>{let t=(0,r.useEventSubContext)(),a=null==t?void 0:t.me.channelName,l=(null==e?void 0:e.limit)||100,i=(null==e?void 0:e.before)||new Date,c=(null==e?void 0:e.after)||new Date;i.setDate(i.getDate()-10),c.setDate(c.getDate()+10);let d={where:"[channel+timestamp]",before:[a,Number(i)],after:[a,Number(c)]};return(0,n.yR)(async()=>{if(null!=a)return await s.db.actions.where(d.where).between(d.before,d.after).reverse().limit(l).sortBy("timestamp")},[a])||[]}}}]);